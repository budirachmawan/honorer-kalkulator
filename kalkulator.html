<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kalkulator Keamanan Nikah & Lahiran</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {font-family:Arial;background:#f3f4f6;margin:0;padding:20px;}
.app {max-width:900px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.card {background:#fff;padding:20px;border-radius:16px;box-shadow:0 4px 15px rgba(0,0,0,.05);}
h2 {margin-top:0;}
input,select,button {width:100%;padding:12px;margin-top:10px;font-size:16px;border-radius:8px;border:1px solid #ddd;}
button {background:#f5c400;border:none;font-weight:bold;cursor:pointer;}
.big {font-size:28px;font-weight:bold;}
.note {font-size:12px;background:#fff3cd;padding:10px;border-radius:8px;margin-top:10px;}
</style>
</head>

<body>

<div class="app">

<div class="card">
<h2>Kalkulator Keamanan</h2>
<label>Status hidup</label>
<select id="status">
  <option value="nikah">Akan Menikah</option>
  <option value="hamil">Hamil</option>
  <option value="anak">Punya Anak</option>
</select>

<label>Penghasilan / bulan</label>
<input id="income" type="number" placeholder="contoh 4000000">

<button onclick="hitung()">Hitung Keamanan</button>
</div>

<div class="card">
<div class="big" id="emas">–</div>
<canvas id="chart"></canvas>
<div id="detail"></div>
<div class="note">
Harga emas diambil dari kurs XAU→IDR pasar global. Harga beli di toko bisa berbeda dan berubah sewaktu-waktu.
</div>
</div>

</div>

<script>
async function getHargaEmas(){
  const res = await fetch("https://api.exchangerate.host/convert?from=XAU&to=IDR");
  const data = await res.json();
  return Math.round(data.result / 31.1035);
}

let chart;

async function hitung(){
  const income = Number(document.getElementById("income").value);
  const status = document.getElementById("status").value;
  const mult = {nikah:6, hamil:4, anak:3};

  const risiko = income * mult[status];
  const hidup = income * 0.7;
  const buffer = hidup * 3;
  let aman = risiko - buffer;
  if(aman < 0) aman = 0;

  const harga = await getHargaEmas();
  const gram = Math.floor(aman / harga);

  document.getElementById("emas").innerHTML = gram + " gram emas";
  document.getElementById("detail").innerHTML = `
    Risiko biaya: Rp ${risiko.toLocaleString()}<br>
    Dana penyangga: Rp ${buffer.toLocaleString()}<br>
    Aman dikunci: Rp ${aman.toLocaleString()}<br>
    Harga emas: Rp ${harga.toLocaleString()} / gram
  `;

  const data = [aman, risiko-aman];
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("chart"),{
    type:"doughnut",
    data:{labels:["Aman","Berisiko"],datasets:[{data}]}
  });
}
</script>

</body>
</html>
