<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HONORER DIGITAL V5.0 (LOCKED)</title>
<!-- FONT -->
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<!-- CHART JS (Safe Load) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===== DESIGN SYSTEM ===== */
:root {
  --primary: #fbbf24;
  --primary-dark: #b45309;
  --primary-gradient: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
  --success: #10b981;
  --success-dark: #047857;
  --success-bg: #ecfdf5;
  --danger: #ef4444;
  --danger-bg: #fef2f2;
  --info: #3b82f6;
  --info-bg: #eff6ff;
  --warning: #f59e0b;
  --bg-body: #f8fafc;
  --bg-card: #ffffff;
  --text-main: #0f172a;
  --text-muted: #64748b;
  --text-light: #94a3b8;
  --border: #e2e8f0;
  --radius-xl: 24px;
  --radius-lg: 16px;
  --shadow-soft: 0 10px 30px -10px rgba(0, 0, 0, 0.05);
  --shadow-float: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
}

* { 
  box-sizing: border-box; 
  -webkit-tap-highlight-color: transparent; 
  outline: none; 
}

body {
  font-family: 'Plus Jakarta Sans', sans-serif;
  background-color: var(--bg-body);
  color: var(--text-main);
  margin: 0;
  padding: 20px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.app-container {
  max-width: 900px;
  width: 100%;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1fr;
  gap: 24px;
}

@media (min-width: 768px) {
  .app-container { 
    grid-template-columns: 400px 1fr; 
    align-items: start; 
  }
}

/* ===== HEADER ===== */
header { 
  text-align: center; 
  margin-bottom: 20px; 
  animation: fadeInDown 0.6s ease-out; 
}
.brand-title { 
  font-size: 28px; 
  font-weight: 800; 
  letter-spacing: -0.05em; 
  color: var(--text-main); 
  margin: 0; 
}
.brand-gold { 
  background: var(--primary-gradient); 
  -webkit-background-clip: text; 
  -webkit-text-fill-color: transparent; 
}

.api-badge {
  display: inline-flex; 
  align-items: center; 
  gap: 6px; 
  padding: 6px 12px;
  background: var(--bg-card); 
  border: 1px solid var(--border); 
  border-radius: 50px;
  font-size: 11px; 
  font-weight: 700; 
  color: var(--text-muted); 
  margin-top: 12px; 
  box-shadow: var(--shadow-soft);
}
.status-dot { 
  width: 8px; 
  height: 8px; 
  border-radius: 50%; 
  background-color: var(--text-light); 
  transition: background 0.3s; 
}
.status-dot.online { 
  background-color: var(--success); 
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2); 
}

/* ===== CARDS ===== */
.card {
  background: var(--bg-card); 
  border-radius: var(--radius-xl); 
  padding: 28px;
  box-shadow: var(--shadow-soft); 
  border: 1px solid rgba(255,255,255,0.8);
  position: relative; 
  overflow: hidden;
}
.slide-up { 
  animation: slideUp 0.7s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; 
  opacity: 0; 
  transform: translateY(20px); 
}

/* ===== INPUTS ===== */
.form-group { 
  margin-bottom: 24px; 
  position: relative; 
}
.form-label { 
  font-size: 12px; 
  font-weight: 700; 
  text-transform: uppercase; 
  letter-spacing: 0.5px; 
  color: var(--text-muted); 
  margin-bottom: 8px; 
  display: block; 
}
.required-mark { 
  color: var(--danger); 
  margin-left: 2px; 
}
.optional-tag { 
  font-size: 10px; 
  font-weight: 400; 
  color: var(--text-light); 
  text-transform: none; 
  margin-left: 6px; 
  letter-spacing: 0; 
}

.input-wrapper { 
  position: relative; 
}
/* OPTIMIZED INPUT STYLING */
.form-input {
  width: 100%; 
  padding: 12px 0; 
  font-size: 16px; 
  font-family: inherit;
  color: var(--text-main); 
  background: transparent; 
  border: none;
  border-bottom: 2px solid var(--border); 
  border-radius: 0;
  transition: all 0.3s ease;
}
/* Use inputmode for numeric keyboard on mobile */
.form-input[inputmode="numeric"] {
  -moz-appearance: textfield;
}
.form-input::-webkit-outer-spin-button,
.form-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.form-input:focus, 
.form-select:focus { 
  border-bottom-color: var(--primary); 
  background: linear-gradient(to top, rgba(251, 191, 36, 0.05), transparent); 
}
.form-select { 
  width: 100%; 
  padding: 12px 0; 
  font-size: 16px; 
  font-family: inherit;
  color: var(--text-main); 
  background: transparent; 
  border: none;
  border-bottom: 2px solid var(--border); 
  border-radius: 0;
  transition: all 0.3s ease;
  appearance: none; 
  cursor: pointer; 
}
.select-arrow { 
  position: absolute; 
  right: 0; 
  top: 14px; 
  pointer-events: none; 
  color: var(--primary); 
  font-size: 12px; 
}
.input-row { 
  display: grid; 
  grid-template-columns: 1fr 1fr; 
  gap: 20px; 
}

/* Toggle Switch */
.switch-container { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  margin-top: 10px; 
}
.switch { 
  position: relative; 
  display: inline-block; 
  width: 44px; 
  height: 24px; 
}
.switch input { 
  opacity: 0; 
  width: 0; 
  height: 0; 
}
.slider { 
  position: absolute; 
  cursor: pointer; 
  top: 0; 
  left: 0; 
  right: 0; 
  bottom: 0; 
  background-color: #ccc; 
  transition: .4s; 
  border-radius: 34px; 
}
.slider:before { 
  position: absolute; 
  content: ""; 
  height: 18px; 
  width: 18px; 
  left: 3px; 
  bottom: 3px; 
  background-color: white; 
  transition: .4s; 
  border-radius: 50%; 
}
input:checked + .slider { 
  background-color: var(--primary); 
}
input:checked + .slider:before { 
  transform: translateX(20px); 
}

/* DREAM CARD DARK THEME */
.dream-card {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); 
  color: white;
  padding: 24px; 
  border-radius: var(--radius-lg); 
  margin-bottom: 24px;
  box-shadow: var(--shadow-float); 
  border: 1px solid #334155;
}
.dream-card label { 
  color: #94a3b8; 
}
.dream-card .form-input, 
.dream-card .form-select {
  background: rgba(255,255,255,0.05); 
  border-bottom-color: rgba(255,255,255,0.2); 
  color: white;
}
.dream-card .form-input:focus, 
.dream-card .form-select:focus {
  background: rgba(255,255,255,0.1); 
  border-bottom-color: var(--primary);
}
.dream-title { 
  font-weight: 700; 
  color: var(--primary); 
  font-size: 14px; 
  margin-bottom: 16px; 
  display: block; 
}

/* ===== BUTTONS ===== */
.btn-main {
  width: 100%; 
  padding: 18px; 
  border: none; 
  border-radius: var(--radius-lg);
  background: var(--primary-gradient); 
  color: white; 
  font-size: 16px; 
  font-weight: 800;
  font-family: inherit; 
  cursor: pointer; 
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 10px 20px -5px rgba(217, 119, 6, 0.4);
  display: flex; 
  justify-content: center; 
  align-items: center;
}
.btn-main:hover { 
  transform: translateY(-2px); 
  box-shadow: 0 15px 25px -5px rgba(217, 119, 6, 0.5); 
}
.btn-main:active { 
  transform: translateY(0); 
}
.btn-secondary {
  width: 100%; 
  padding: 14px; 
  background: white; 
  color: var(--text-muted);
  border: 2px solid var(--border); 
  border-radius: var(--radius-lg); 
  font-weight: 700;
  cursor: pointer; 
  margin-top: 12px; 
  transition: 0.2s;
}
.btn-secondary:hover { 
  border-color: var(--text-main); 
  color: var(--text-main); 
}

/* ===== RESULT SECTION ===== */
.result-hero { 
  text-align: center; 
  margin-bottom: 30px; 
  padding-bottom: 20px; 
  border-bottom: 1px dashed var(--border); 
}
.hero-label { 
  font-size: 11px; 
  text-transform: uppercase; 
  letter-spacing: 1.5px; 
  color: var(--text-muted); 
  margin-bottom: 8px; 
  font-weight: 700; 
}
.hero-value { 
  font-size: 42px; 
  font-weight: 900; 
  color: var(--text-main); 
  line-height: 1; 
  letter-spacing: -1.5px; 
}
.hero-sub { 
  font-size: 14px; 
  color: var(--success); 
  font-weight: 600; 
  margin-top: 8px; 
  display: inline-block; 
  background: var(--success-bg); 
  padding: 4px 12px; 
  border-radius: 20px; 
}

/* FIXED CHART CONTAINER */
.chart-wrapper { 
  position: relative; 
  height: 250px; 
  width: 100%; 
  margin-bottom: 24px; 
  min-height: 250px;
  max-height: 250px;
}

.info-grid { 
  display: grid; 
  grid-template-columns: 1fr; 
  gap: 16px; 
}
.info-box {
  background: #f8fafc; 
  padding: 16px; 
  border-radius: var(--radius-lg);
  border: 1px solid transparent; 
  transition: 0.2s;
}
.info-box:hover { 
  border-color: var(--border); 
  background: white; 
}
.info-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 8px; 
}
.info-title { 
  font-size: 12px; 
  font-weight: 700; 
  color: var(--text-muted); 
  text-transform: uppercase; 
}
.info-tag { 
  font-size: 10px; 
  padding: 4px 8px; 
  border-radius: 4px; 
  font-weight: 700; 
  background: rgba(0,0,0,0.05); 
}
.info-price { 
  font-size: 20px; 
  font-weight: 800; 
  color: var(--text-main); 
  letter-spacing: -0.5px; 
  margin-top:4px; 
}
.info-desc { 
  font-size: 13px; 
  color: var(--text-muted); 
  line-height: 1.5; 
  margin-top: 4px; 
}

.tag-warning { 
  background: #fffbeb; 
  color: var(--warning); 
  border: 1px solid #fcd34d; 
}
.tag-success { 
  background: var(--success-bg); 
  color: var(--success); 
}
.tag-info { 
  background: var(--info-bg); 
  color: var(--info); 
}

/* Gamification Progress */
.progress-container { 
  margin-top: 10px; 
}
.progress-labels { 
  display: flex; 
  justify-content: space-between; 
  font-size: 11px; 
  color: var(--text-muted); 
  margin-bottom: 4px; 
}
.progress-track { 
  height: 8px; 
  background: #e2e8f0; 
  border-radius: 4px; 
  overflow: hidden; 
}
.progress-fill { 
  height: 100%; 
  background: var(--primary-gradient); 
  width: 0%; 
  transition: width 1s ease; 
}

/* List Styling */
.budget-list { 
  list-style: none; 
  padding: 0; 
  margin: 10px 0 0 0; 
}
.budget-list li { 
  font-size: 13px; 
  color: var(--text-muted); 
  margin-bottom: 4px; 
  padding-left: 12px; 
  position: relative; 
}
.budget-list li::before { 
  content: "‚Ä¢"; 
  position: absolute; 
  left: 0; 
  color: var(--primary); 
  font-weight: bold; 
}

/* Advice Section */
.advice-card {
  background: #fff; 
  border: 1px solid var(--border); 
  padding: 16px; 
  border-radius: var(--radius-lg);
  margin-bottom: 16px; 
  box-shadow: var(--shadow-soft);
}
.advice-title { 
  font-weight: 700; 
  margin-bottom: 12px; 
  display: flex; 
  align-items: center; 
  gap: 8px; 
  font-size: 14px; 
}
.advice-list { 
  font-size: 13px; 
  line-height: 1.6; 
  color: var(--text-main); 
  font-weight: 500; 
}
.advice-list li { 
  margin-bottom: 8px; 
  padding-left: 20px; 
  position: relative; 
}
.advice-list li::before { 
  content: "‚úÖ"; 
  position: absolute; 
  left: 0; 
  color: var(--success); 
  font-weight: bold; 
}

/* Hustle Tags */
.hustle-container { 
  margin-top: 10px; 
  display: flex; 
  flex-wrap: wrap; 
  gap: 8px; 
}
.hustle-tag {
  font-size: 10px; 
  background: white; 
  border: 1px solid var(--primary); 
  color: var(--primary-dark);
  padding: 4px 10px; 
  border-radius: 20px; 
  font-weight: 700;
}

/* Dream Result Specifics */
.dream-result-card {
  background: white; 
  border: 1px solid var(--border); 
  padding: 16px; 
  border-radius: var(--radius-lg);
  margin-bottom: 16px; 
  box-shadow: var(--shadow-soft);
}
.dream-status-badge {
  display: inline-block; 
  padding: 6px 12px; 
  border-radius: 8px; 
  font-weight: 800; 
  text-transform: uppercase; 
  font-size: 12px; 
  margin-top: 10px; 
  width: 100%; 
  text-align: center;
}
.status-success { 
  background: var(--success-bg); 
  color: var(--success); 
}
.status-fail { 
  background: var(--danger-bg); 
  color: var(--danger); 
}
.status-danger { 
  background: #7f1d1d; 
  color: white; 
  border: 1px solid #991b1b; 
}

/* Executive Summary */
.summary-text { 
  font-size: 13px; 
  line-height: 1.6; 
  color: var(--text-main); 
  margin-bottom: 12px; 
}
.summary-heading { 
  font-size: 11px; 
  font-weight: 700; 
  text-transform: uppercase; 
  color: var(--primary-dark); 
  margin-bottom: 6px; 
}
.solution-list { 
  list-style: none; 
  padding: 0; 
}
.solution-list li { 
  margin-bottom: 8px; 
  font-weight: 500; 
}

/* FIXED ACCOUNTING BOX STYLE */
.acc-box {
  background: var(--text-main); 
  color: white; 
  padding: 16px; 
  border-radius: var(--radius-lg);
  margin-top: 16px; 
  border: 1px solid #334155;
}
.acc-row {
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  margin-bottom: 8px; 
  font-size: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.1); 
  padding-bottom: 8px;
}
.acc-row:last-child { 
  border-bottom: none; 
}
.acc-label { 
  font-weight: 500; 
  color: #cbd5e1; 
  font-size: 13px; 
  flex: 1;
}
.acc-val { 
  font-weight: 800; 
  color: #fff; 
  font-size: 15px; 
  letter-spacing: -0.5px;
  text-align: right;
  flex: 1;
}
.acc-val.neg { 
  color: #fca5a5; 
}
.acc-val.pos { 
  color: #34d399; 
}
.acc-divider { 
  border-top: 1px dashed rgba(255,255,255,0.3); 
  margin-top: 4px; 
  padding-top: 8px; 
  font-weight: 700; 
  text-transform: uppercase; 
  font-size: 11px; 
  letter-spacing: 1px; 
  text-align: center;
}

/* Locked / Donate Section */
.locked-section {
  margin-top: 24px; 
  padding: 24px; 
  border: 2px dashed var(--border);
  background: #fff; 
  border-radius: var(--radius-xl); 
  text-align: center;
}

/* Product Cards (Updated) */
.product-grid { 
  display: grid; 
  grid-template-columns: 1fr 1fr; 
  gap: 12px; 
  margin-top: 20px; 
}
.product-card {
  background: white; 
  border: 1px solid var(--border); 
  padding: 20px 16px;
  border-radius: var(--radius-lg); 
  text-decoration: none; 
  color: inherit;
  display: block; 
  transition: 0.2s;
  text-align: left;
}
.product-card:hover { 
  transform: translateY(-3px); 
  border-color: var(--primary); 
  box-shadow: var(--shadow-soft); 
}
.product-icon { 
  font-size: 28px; 
  margin-bottom: 8px; 
}
.product-title { 
  font-weight: 700; 
  margin-top: 4px; 
  font-size: 14px; 
  color: var(--text-main); 
}
.product-desc { 
  font-size: 11px; 
  color: var(--text-muted); 
  margin-bottom: 8px; 
  line-height: 1.3; 
}

/* Buttons */
.btn-donate, .btn-consult {
  display: inline-block; 
  width: 100%; 
  padding: 12px; 
  margin-bottom: 8px; 
  border: none;
  border-radius: 8px; 
  font-weight: 700; 
  font-size: 13px;
  text-decoration: none; 
  transition: 0.2s; 
  text-align: center;
}
.btn-donate {
  background: var(--primary-gradient); 
  color: white; 
  box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
}
.btn-consult {
  background: white; 
  color: var(--info); 
  border: 1px solid var(--info);
}
.btn-donate:hover { 
  box-shadow: 0 6px 15px rgba(245, 158, 11, 0.5); 
  transform: translateY(-2px); 
}
.btn-consult:hover { 
  background: var(--info-bg); 
  transform: translateY(-2px); 
}

.hidden { 
  display: none !important; 
}

/* Mobile Optimization */
@media (max-width: 768px) {
  .app-container {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  .card {
    padding: 20px;
  }
  
  .input-row {
    grid-template-columns: 1fr;
    gap: 16px;
  }
  
  /* Make button more accessible on mobile */
  .btn-main {
    position: relative;
    margin-top: 8px;
  }
  
  /* Adjust font sizes for mobile */
  .hero-value {
    font-size: 36px;
  }
  
  .chart-wrapper {
    height: 220px;
    min-height: 220px;
    max-height: 220px;
  }
  
  /* Better touch targets */
  .form-input, .form-select {
    padding: 14px 0;
    font-size: 16px;
  }
  
  .product-grid {
    grid-template-columns: 1fr;
  }
}

@keyframes fadeInDown { 
  from { 
    opacity: 0; 
    transform: translateY(-20px); 
  } 
  to { 
    opacity: 1; 
    transform: translateY(0); 
  } 
}
@keyframes slideUp { 
  from { 
    opacity: 0; 
    transform: translateY(30px); 
  } 
  to { 
    opacity: 1; 
    transform: translateY(0); 
  } 
}
</style>
</head>
<body>

<div class="app-container">
  
  <!-- LEFT COLUMN: INPUT -->
  <div class="card slide-up" id="input-section">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
      <h3 style="margin:0; font-size:18px; font-weight:800;">Data Keuangan</h3>
      <div id="apiStatus" class="api-badge"><span class="status-dot"></span> <span id="api-text">Checking...</span></div>
    </div>

    <div class="input-row form-group">
      <div>
        <label class="form-label">Gaji Pokok <span class="required-mark">*</span></label>
        <input class="form-input" type="text" id="gajiPokok" placeholder="Contoh: 5000000" inputmode="numeric" autocomplete="off">
      </div>
      <div>
        <label class="form-label">Side Hustle <span class="optional-tag">(Opsional)</span></label>
        <input class="form-input" type="text" id="sideHustle" placeholder="Contoh: 1000000" inputmode="numeric" autocomplete="off">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Status Saat Ini</label>
      <div class="input-wrapper">
        <select class="form-select" id="status">
          <option value="nikah">Akan Menikah</option>
          <option value="hamil">Persiapan Hamil</option>
          <option value="anak">Sudah Punya Anak</option>
        </select>
        <span class="select-arrow">‚ñº</span>
      </div>
    </div>

    <!-- Target Tanggal -->
    <div class="form-group">
      <label class="form-label">Target Tanggal Pencapaian <span class="optional-tag">(Opsional)</span></label>
      <input class="form-input" type="date" id="targetDate" style="color: var(--text-muted);">
      <div style="font-size:11px; color:var(--text-light); margin-top:6px;">Contoh: Tanggal rencana nikah / target tabungan.</div>
      
      <div class="switch-container">
        <span style="font-size:11px; font-weight:700; color:var(--text-muted);">Kalkulasi Inflasi (Est. 6% / thn)</span>
        <label class="switch">
          <input type="checkbox" id="inflationToggle">
          <span class="slider"></span>
        </label>
      </div>
    </div>

    <div class="input-row form-group">
      <div>
        <label class="form-label">Gaya Hidup</label>
        <div class="input-wrapper">
          <select class="form-select" id="lifestyle">
            <option value="hemat">Hemat (Frugal)</option>
            <option value="standar" selected>Standar</option>
            <option value="mewah">Mewah</option>
          </select>
          <span class="select-arrow">‚ñº</span>
        </div>
      </div>
      <div>
        <label class="form-label">Total Utang <span class="optional-tag">(Opsional)</span></label>
        <input class="form-input" type="text" id="debt" placeholder="Contoh: 500000" inputmode="numeric" autocomplete="off">
      </div>
    </div>

    <!-- Tabungan Saat Ini -->
    <div class="form-group">
      <label class="form-label">Tabungan Saat Ini <span class="optional-tag">(Opsional)</span></label>
      <input class="form-input" type="text" id="currentSavings" placeholder="Contoh: 2000000" inputmode="numeric" autocomplete="off" style="color:var(--primary);">
      <div style="font-size:10px; color:var(--text-light); margin-top:4px;">Wajib diisi untuk Akuntansi.</div>
    </div>

    <!-- DREAM CARD -->
    <div class="dream-card">
      <div class="dream-header">
        <span class="dream-title">üéØ DREAM PLANNER (Opsional)</span>
      </div>
      <div class="input-row" style="margin-bottom:12px;">
        <div class="input-wrapper" style="flex:2;">
          <select class="form-select" id="dreamType" style="color:var(--text-light);">
            <option value="none">-- Pilih Aset --</option>
            <option value="rumah">Rumah / KPR</option>
            <option value="motor">Motor</option>
            <option value="mobil">Mobil</option>
            <option value="haji">Daftar Haji</option>
            <option value="gadget">Gadget</option>
            <option value="liburan">Liburan</option>
          </select>
        </div>
        <div class="input-wrapper" style="flex:1;">
          <select class="form-select" id="dreamMethod" style="color:var(--text-light);">
            <option value="tunai">Tunai</option>
            <option value="kredit">Kredit (Cicilan)</option>
          </select>
        </div>
      </div>
      
      <div id="dpContainer" class="hidden" style="margin-bottom: 12px; border-bottom: 1px dashed rgba(255,255,255,0.2); padding-bottom:12px;">
        <label class="form-label" style="color:#94a3b8;">Uang Muka (DP) %</label>
        <input class="form-input" type="number" id="dpPercent" value="20" min="10" max="90" style="padding: 8px 0; font-size: 14px;" inputmode="numeric">
        
        <!-- NEW CREDIT INPUTS -->
        <div class="input-row" style="margin-top:12px;">
          <div>
            <label class="form-label" style="color:#94a3b8; font-size:10px;">Tenor (Thn)</label>
            <select class="form-select" id="tenorYears" style="padding: 8px 0; font-size: 14px; background:rgba(255,255,255,0.05);">
              <option value="1">1 Tahun</option>
              <option value="3" selected>3 Tahun</option>
              <option value="5">5 Tahun</option>
            </select>
          </div>
          <div>
            <label class="form-label" style="color:#94a3b8; font-size:10px;">Bunga (%/thn)</label>
            <input class="form-input" type="number" id="interestRate" value="12" min="1" max="30" style="padding: 8px 0; font-size: 14px;" inputmode="numeric">
          </div>
        </div>
      </div>

      <input class="form-input" type="text" id="dreamPrice" placeholder="Estimasi Harga Cash (Rp)" inputmode="numeric" autocomplete="off" style="margin-bottom: 0;">
    </div>

    <button class="btn-main" id="btn-calc" onclick="hitung()">
      <span id="btn-text">ANALISIS KEAMANAN SAYA</span>
    </button>
    <button class="btn-secondary hidden" id="unlock-btn" onclick="unlockForm()">‚úèÔ∏è Edit Data Ulang</button>
  </div>

  <!-- RIGHT COLUMN: RESULT -->
  <div class="card slide-up" style="animation-delay: 0.2s;" id="result-section">
    
    <div class="result-hero">
      <div class="hero-label">Total Aset Aman Tercatat</div>
      <div class="hero-value" id="emas">0 gram</div>
      <div class="hero-sub">Dana yang bisa dikunci ke emas</div>
    </div>

    <div class="chart-wrapper">
      <canvas id="chart"></canvas>
    </div>

    <!-- HIDDEN BY DEFAULT (LOCKED) -->
    <div id="detail-container" class="hidden">
      
      <!-- GAMIFICATION -->
      <div id="gamification-wrapper" class="info-box" style="background:var(--info-bg); border-color:var(--info);">
        <div class="info-header">
          <div class="info-title" style="color:var(--info);">Progres Perjalanan Finansial</div>
          <span class="info-tag" style="background:var(--info); color:white;">Level Up</span>
        </div>
        <div style="font-size:12px; margin-bottom:4px;">Target: <span id="prog-target">Rp 0</span> | Terkumpul: <span id="prog-current">Rp 0</span></div>
        <div class="progress-container">
          <div class="progress-track"><div class="progress-fill" id="prog-bar"></div></div>
        </div>
        <div style="text-align:center; font-size:11px; font-weight:700; color:var(--text-main); margin-top:8px;">
          Jarak ke target: <span id="prog-percent">0%</span>
        </div>
      </div>

      <!-- DREAM RESULT -->
      <div id="dream-result-wrapper"></div>

      <!-- ANALISA BULANAN -->
      <div class="info-box" id="monthly-analysis-card">
        <div class="info-header">
          <div class="info-title" style="color:var(--info);">Analisa Bulanan</div>
          <span class="info-tag tag-info">Cash Flow</span>
        </div>
        <div style="font-size:13px; margin-bottom:8px; font-weight:600;">Total Penghasilan: <span id="cash-income" style="color:var(--text-main);">Rp 0</span></div>
        <div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:4px; color:var(--text-muted);">
          <span>Kebutuhan Hidup</span>
          <span id="cash-needs">0 (70%)</span>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:4px; color:var(--text-muted);">
          <span>Cicilan Utang</span>
          <span id="cash-debt">0 (0%)</span>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:13px; margin-top:8px; border-top:1px dashed var(--border); padding-top:8px;">
          <span style="font-weight:700;">Kemampuan Menabung (Nyata)</span>
          <span id="cash-save" style="font-weight:800; color:var(--success);">0 (0%)</span>
        </div>
      </div>

      <!-- DETAILED CARDS -->
      <div class="info-grid" style="margin-top:16px;">
        
        <!-- Card A: Penyangga -->
        <div class="info-box">
          <div class="info-header">
            <div class="info-title">Dana Penyangga Hidup</div>
            <span class="info-tag tag-warning">Wajib Tunai</span>
          </div>
          <div class="info-price" id="buffer-price">Rp 0</div>
          <div class="info-desc">Uang tunai ini wajib ada di rekening. Ini adalah sabuk pengaman keuanganmu.</div>
        </div>

        <!-- Card B: Kebutuhan Dana Besar (10 Items) -->
        <div class="info-box">
          <div class="info-header">
            <div class="info-title">Kebutuhan Dana Besar</div>
            <span class="info-tag" id="lifestyle-tag-detail">Standar</span>
          </div>
          <div class="info-price" id="target-price-detail">Rp 0</div>
          <div id="inflation-alert"></div>
          <div class="info-desc">Estimasi biaya realistis dengan gaya hidup <span id="lifestyle-text">Standar</span>.</div>
          <ul class="budget-list" id="budget-list-items"></ul>
        </div>

        <!-- Card C: Dana Siap Dikunci -->
        <div class="info-box" style="background: var(--success-bg); border-color: #a7f3d0;">
          <div class="info-header">
            <div class="info-title">Dana Siap Dikunci</div>
            <span class="info-tag tag-success">Bisa di Emas</span>
          </div>
          <div class="info-price" style="color: var(--success-dark);" id="safe-price-detail">Rp 0</div>
          <div class="info-desc">Ini adalah sisa dana dari total kebutuhan yang aman untuk dikunci.</div>
          <div style="margin-top:12px; font-size:12px; font-weight:700; color:var(--success-dark);">Setara emas: <span id="gram-detail">0</span> gram</div>
          <div style="font-size:12px; color:var(--success-dark);">Harga emas: <span id="gold-price-detail">Rp 0</span> / gram</div>
        </div>

      </div>

      <!-- ACCOUNTING SUMMARY (LOCKED) -->
      <div id="accounting-wrapper" class="acc-box">
        <div style="text-align:center; margin-bottom:16px; font-weight:700; letter-spacing:1px; text-transform:uppercase;">Laporan Laba Rugi (Snapshot)</div>
        
        <div class="acc-row">
          <div class="acc-label">Total Aset (Masuk)</div>
          <div class="acc-val">Rp 0</div>
        </div>
        <div style="font-size:10px; color:#cbd5e1; text-align:right; padding:0 0 4px 0;">(Gaji + Tabungan)</div>

        <div class="acc-row">
          <div class="acc-label">Total Beban (Keluar)</div>
          <div class="acc-val">Rp 0</div>
        </div>
        <div style="font-size:10px; color:#cbd5e1; text-align:right; padding:0 0 4px 0;">(Biaya Target + Total Utang)</div>

        <div class="acc-row acc-divider">
          <div class="acc-label">SURPLUS / DEFISIT</div>
          <div class="acc-val" id="acc-net-result">Rp 0</div>
        </div>
      </div>

      <!-- SOLUTION LIST -->
      <div id="solution-wrapper" class="info-box" style="background:white; border: 1px solid var(--primary);">
        <div class="info-header">
          <div class="info-title" style="color:var(--primary-dark);">üìã Solusi & Rekomendasi</div>
        </div>
        <ul class="summary-list" id="solution-list-content"></ul>
      </div>

      <!-- STRATEGI CERDAS (SIDE HUSTLE) -->
      <div id="strategy-wrapper"></div>

      <!-- TARGET PLAN -->
      <div id="target-plan-card" class="info-box" style="margin-top:16px; background: white; border: 2px solid var(--primary);">
        <div class="info-header">
          <div class="info-title" style="color:var(--primary-dark);">Target Tanggal</div>
          <span class="info-tag" style="background:var(--primary-gradient); color:white;">Hitung Mundur</span>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
          <div style="font-weight:700;">Target Tanggal:</div>
          <div id="plan-date">-</div>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
          <div style="font-weight:700;">Sisa Waktu:</div>
          <div id="plan-months" style="color:var(--danger); font-weight:800;">0 Bulan</div>
        </div>
        
        <div style="background:#fffbeb; padding:12px; border-radius:8px; border:1px solid #fcd34d; margin-bottom:12px;">
          <div style="font-size:11px; font-weight:800; color:#b45309; margin-bottom:8px; text-transform:uppercase;">üî• Langkah Nyata Harian</div>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:8px;">
            <div style="text-align:center;">
              <div style="font-size:10px; color:#92400e;">Target Harian</div>
              <div style="font-size:14px; font-weight:800; color:#92400e;" id="plan-daily">Rp 0</div>
            </div>
            <div style="text-align:center;">
              <div style="font-size:10px; color:#92400e;">Target Mingguan</div>
              <div style="font-size:14px; font-weight:800; color:#92400e;" id="plan-weekly">Rp 0</div>
            </div>
          </div>
          <div style="font-size:11px; color:#b45309; font-style:italic; text-align:center;" id="plan-context">Hemat dari pengeluaran rutin.</div>
        </div>

        <div style="border-top:1px dashed var(--border); padding-top:12px;">
          <span style="font-size:13px; color:var(--text-muted);">Total Bulanan:</span>
          <div style="font-size:18px; font-weight:900; color:var(--text-main);" id="plan-monthly">Rp 0 / bln</div>
          
          <div id="plan-comparison-box" style="margin-top:8px; padding:8px; border-radius:6px; font-size:12px; line-height:1.4;"></div>
        </div>
      </div>

      <!-- NASEHAH HARIAN -->
      <div id="advice-wrapper" class="advice-card">
        <div class="advice-title">üí° Nasehat Harianmu (5 Tips)</div>
        <ul class="advice-list" id="advice-list-content"></ul>
      </div>

      <!-- LOCKED / DONATE / KONSULTASI -->
      <div class="locked-section">
        <div style="font-size:24px; margin-bottom:8px;">üíé</div>
        <h4 style="margin:0 0 4px 0; color:var(--text-main);">Paket Premium</h4>
        <p style="font-size:13px; color:var(--text-muted); margin:0 0 16px 0;">Template Excel & E-Book.</p>
        
        <div class="product-grid">
          <a href="#" id="wa-excel" class="product-card" target="_blank">
            <div class="product-icon">üìÇ</div>
            <div class="product-title">Template Excel</div>
            <div class="product-desc">Tabel hitung otomatis lengkap sesuai hasil kalkulator ini.</div>
          </a>
          <a href="#" id="wa-ebook" class="product-card" target="_blank">
            <div class="product-icon">üìò</div>
            <div class="product-title">Panduan Emas (E-Book)</div>
            <div class="product-desc">Cara beli emas mulia dari gram kecil & tips gadai.</div>
          </a>
        </div>
        
        <a href="#" id="wa-consult" class="btn-consult">üí¨ Konsultasi Keuangan</a>
        <a href="#" id="wa-donate" class="btn-donate">‚ù§Ô∏è Dukung Pengembang</a>
        
        <div style="margin-top:12px;">
           <a href="#" id="wa-feedback" style="font-size:12px; color:var(--text-muted); text-decoration:underline;">Kirim Kritik & Saran</a>
        </div>
      </div>

    </div>

    <!-- Initial State Message -->
    <div id="initial-msg" style="text-align:center; padding: 40px 0; color:var(--text-light);">
      <div style="font-size:40px; margin-bottom:16px;">üìä</div>
      <p>Silakan isi data keuangan Anda di sebelah kiri untuk melihat analisa keamanan finansial.</p>
    </div>

  </div>
</div>

<script>
// --- UTILITIES ---
const formatIDR = (x) => {
  if(!x || isNaN(x)) return "Rp 0";
  return new Intl.NumberFormat("id-ID").format(x);
};

// --- IMPROVED INPUT FORMATTING ---
let isFormatting = false;

const formatInputValue = (element) => {
  if (!element || isFormatting) return;
  
  isFormatting = true;
  
  // Save cursor position
  const start = element.selectionStart;
  const end = element.selectionEnd;
  
  // Get raw value and remove all non-digits
  let rawValue = element.value.replace(/[^0-9]/g, "");
  
  // If empty, clear and exit
  if (!rawValue) {
    element.value = "";
    isFormatting = false;
    return;
  }
  
  // Parse to number
  const numValue = parseInt(rawValue, 10);
  
  // Format with thousand separators
  if (!isNaN(numValue)) {
    element.value = numValue.toLocaleString("id-ID");
    
    // Restore cursor position (adjust for added separators)
    const formattedLength = element.value.length;
    const originalLength = rawValue.length;
    const separatorCount = formattedLength - originalLength;
    
    let newStart = start;
    let newEnd = end;
    
    // Count separators before original cursor position
    let separatorsBeforeStart = 0;
    for (let i = 0; i < Math.min(start, formattedLength); i++) {
      if (element.value[i] === '.') {
        separatorsBeforeStart++;
      }
    }
    
    newStart = start + separatorsBeforeStart;
    newEnd = end + separatorsBeforeStart;
    
    // Ensure cursor stays within bounds
    newStart = Math.min(newStart, formattedLength);
    newEnd = Math.min(newEnd, formattedLength);
    
    // Set cursor position
    setTimeout(() => {
      element.setSelectionRange(newStart, newEnd);
      isFormatting = false;
    }, 0);
  } else {
    element.value = "";
    isFormatting = false;
  }
};

// Initialize input formatting
const initializeInputFormatting = () => {
  const numericInputs = ['gajiPokok', 'sideHustle', 'debt', 'dreamPrice', 'currentSavings'];
  
  numericInputs.forEach(id => {
    const input = document.getElementById(id);
    if (input) {
      // Format on blur (when user leaves the field)
      input.addEventListener('blur', () => {
        formatInputValue(input);
      });
      
      // Also format when Enter is pressed
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          formatInputValue(input);
        }
      });
    }
  });
};

// Parse formatted number back to integer
const parseFormattedNumber = (formattedString) => {
  if (!formattedString) return 0;
  // Remove all non-digit characters
  const digitsOnly = formattedString.replace(/[^0-9]/g, "");
  return parseInt(digitsOnly, 10) || 0;
};

// --- GOLD API LOGIC ---
let chartInstance = null;

async function getHargaEmas() {
  const badgeText = document.getElementById('api-text');
  const dot = document.querySelector('.status-dot');
  const cacheKey = 'harga_emas_cache';
  
  try {
    // Try to get cached data first
    const cached = localStorage.getItem(cacheKey);
    if(cached) {
      const cacheData = JSON.parse(cached);
      // Use cache if less than 15 minutes old
      if(Date.now() - cacheData.time < 15 * 60 * 1000) {
        badgeText.innerText = "LIVE (Cached)"; 
        dot.classList.add('online');
        return cacheData.price;
      }
    }
    
    // Update status
    badgeText.innerText = "Updating...";
    
    // Fetch fresh data
    const response = await fetch("https://logam-mulia-api.vercel.app/api/antam");
    if (!response.ok) throw new Error("API response not OK");
    
    const data = await response.json();
    
    // Cache the new price
    localStorage.setItem(cacheKey, JSON.stringify({
      time: Date.now(), 
      price: data.buy
    }));
    
    badgeText.innerText = "LIVE"; 
    dot.classList.add('online');
    return data.buy;
    
  } catch(err) {
    console.log("Gold API error (using fallback):", err);
    badgeText.innerText = "OFFLINE"; 
    dot.classList.remove('online');
    
    // Try to get cached data even if expired
    const cached = localStorage.getItem(cacheKey);
    if(cached) {
      const cacheData = JSON.parse(cached);
      return cacheData.price;
    }
    
    // Fallback price
    return 1000000; // Safe fallback price
  }
}

// --- IMPROVED CHART RENDERER ---
function renderChart(aman, buffer) {
  const ctx = document.getElementById('chart');
  if(!ctx) return;
  
  try {
    // Destroy previous chart if exists
    if(chartInstance) {
      chartInstance.destroy();
    }
    
    // Create new chart with fixed dimensions
    chartInstance = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: ["Aman (Emas)", "Penyangga (Tunai)"],
        datasets: [{
          data: [aman, buffer],
          backgroundColor: ["#10b981", "#fbbf24"],
          borderWidth: 0, 
          hoverOffset: 4
        }]
      },
      options: {
        cutout: '75%', 
        responsive: true, 
        maintainAspectRatio: false,
        plugins: { 
          legend: { 
            position: 'bottom', 
            labels: { 
              usePointStyle: true, 
              padding: 20, 
              font: {
                family: 'Plus Jakarta Sans',
                size: 12
              }
            } 
          } 
        },
        animation: { 
          animateScale: true, 
          animateRotate: true,
          duration: 1000
        }
      }
    });
  } catch(e) {
    console.log("Chart Error:", e);
    // Don't let chart crash stop the app
  }
}

// --- DP INPUT TOGGLE ---
document.getElementById('dreamMethod').addEventListener('change', (e) => {
  const dpContainer = document.getElementById('dpContainer');
  if(e.target.value === 'kredit') {
    dpContainer.classList.remove('hidden');
  } else {
    dpContainer.classList.add('hidden');
  }
});

// --- LOAD DATA ---
window.onload = async () => { 
  await getHargaEmas();
  initializeInputFormatting();
};

// --- LOCKING ---
function unlockForm() {
  document.getElementById('input-section').classList.remove('hidden');
  document.getElementById('unlock-btn').classList.add('hidden');
  document.getElementById('detail-container').classList.add('hidden');
  document.getElementById('initial-msg').classList.remove('hidden');
  document.getElementById('btn-calc').classList.remove('hidden');
}

// --- ADVICE DATABASE ---
const adviceDB = {
  nikah: ["Utamakan Mahar dalam bentuk Emas.", "Gunakan undangan digital.", "Catering: Nasi box enak lebih disukai.", "Sewa dekorasi 'Backdrop Only'.", "Jangan beli semua perlengkapan baru."],
  hamil: ["Cek fasilitas kelas 3 BPJS.", "Stok Pampers saat promo.", "Vitamin dan Nutrisi ibu adalah prioritas.", "Tips Hemat Susu: ASI eksklusif.", "Jangan terlalu sering USG kosmetik."],
  anak: ["Mainan edukasi lebih baik.", "Bekal makan dari rumah.", "Susu UHT plain lebih baik untuk gigi.", "Tukar baju dengan saudara sepupu.", "Bimbing belajar sendiri gratis."]
};

// --- HUSTLE DATABASE ---
const hustleDB = {
  rumah: ["Usaha Online", "Warung Kelontong", "Kedai Online", "Renovasi Ringan", "Tukang Kayu", "Agen Properti", "Interior Desain", "Home Cleaning", "Dekorasi", "Katering"],
  motor: ["Ojek Online", "Kurir Barang", "Sales Offline", "Kopi Keliling", "Cuci Motor", "Tambal Ban", "Servis Panggilan", "Titip Jual Part", "Bengkel", "Sparepart Bekas"],
  mobil: ["Kopi Keliling Mobil", "Travel Agent", "Rental Car", "Ojek Online Mobil", "Supir", "Agen Asuransi", "Cuci Mobil", "Aksesoris", "Sewa Mobil"],
  gadget: ["Konten Kreator", "Editing Photo/Video", "Freelance Fiverr", "Affiliate", "Dropshipper", "Servis HP", "Flashing HP", "Jual HP Bekas", "Reseller Aksesoris"],
  liburan: ["Content Creator", "Fotografer", "Tour Guide", "Cenderamatah", "Organizer", "Tiket Wisata", "Travel Planning", "Sewa Kamera", "Wedding Organizer", "Tour Leader"],
  haji: ["Jualan Oleh-oleh", "Katering Nasi Box", "Busana Muslim", "Agen Umroh", "Pembimbing Ibadah", "Pernak Pernikah", "Travel Umroh", "Kit Umroh", "Titip Jual", "Kain Tenun"],
  none: ["Freelance Umum", "Jualan Online", "Admin Sosmed", "Private Tutor", "Sewa Barang"]
};

// --- CORE CALCULATION ---
async function hitung() {
  try {
    // Format all inputs before calculation
    const numericInputs = ['gajiPokok', 'sideHustle', 'debt', 'dreamPrice', 'currentSavings'];
    numericInputs.forEach(id => {
      const input = document.getElementById(id);
      if (input) {
        formatInputValue(input);
      }
    });

    // Get values using improved parser
    const income = parseFormattedNumber(document.getElementById('gajiPokok').value) + 
                   parseFormattedNumber(document.getElementById('sideHustle').value);
    const debt = parseFormattedNumber(document.getElementById('debt').value);
    const currentSavings = parseFormattedNumber(document.getElementById('currentSavings').value);
    const dreamPrice = parseFormattedNumber(document.getElementById('dreamPrice').value);
    
    // Validate required field
    if(!income || isNaN(income) || income <= 0) { 
      alert("Mohon isi Gaji Pokok Anda dengan benar (minimal 1)"); 
      return; 
    }

    // Loading state
    const btn = document.getElementById('btn-calc');
    const btnText = document.getElementById('btn-text');
    const originalText = btnText.innerText;
    btn.disabled = true; 
    btnText.innerText = "MENGHITUNG...";

    // --- MATHS LOGIC ---
    const lifestyleFactor = { 'hemat': 0.8, 'standar': 1.0, 'mewah': 1.5 };
    const baseMult = { 'nikah':6, 'hamil':4, 'anak':3 };
    const statusVal = document.getElementById('status').value;
    const lifestyleVal = document.getElementById('lifestyle').value;
    const useInflation = document.getElementById('inflationToggle').checked;
    
    // Calculate target
    let target = Math.ceil(income * baseMult[statusVal] * lifestyleFactor[lifestyleVal]);
    if(isNaN(target) || target <= 0) target = 0;

    let inflationHTML = "";
    
    if (useInflation) {
      const dateInput = document.getElementById('targetDate').value;
      if(dateInput) {
        const targetDate = new Date(dateInput);
        const today = new Date();
        
        // Calculate years difference
        const years = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24 * 365)));
        
        if(years > 0) {
          const inflatedTarget = Math.ceil(target * Math.pow(1.06, years));
          inflationHTML = `
            <div style="font-size:11px; color:var(--danger); background:var(--danger-bg); padding:4px 8px; border-radius:4px; display:inline-block; margin-bottom:4px;">
              ‚ö†Ô∏è Dengan Inflasi: <strong>Rp ${formatIDR(inflatedTarget)}</strong>
            </div>`;
          target = inflatedTarget;
        }
      }
    }

    const buffer = Math.ceil(income * 0.7 * 3);
    const aman = Math.max(0, target - buffer);
    
    // Update gold display
    document.getElementById('emas').innerText = (aman / 1000000).toFixed(2) + " gram";
    
    // Render chart with fixed dimensions
    renderChart(aman, buffer);

    // --- ADVICE ---
    const adviceWrapper = document.getElementById('advice-wrapper');
    const tips = adviceDB[statusVal] || ["Prioritaskan kebutuhan dasar.", "Hindari utang konsumtif.", "Sisihkan minimal 10% untuk tabungan.", "Evaluasi pengeluaran bulanan.", "Buat rencana keuangan jangka pendek."];
    const shuffledTips = [...tips].sort(() => 0.5 - Math.random());
    adviceWrapper.innerHTML = `
      <div class="advice-title">üí° Nasehat Harianmu (${statusVal.toUpperCase()})</div>
      <ul class="advice-list">
        ${shuffledTips.slice(0, 5).map(t => `<li>${t}</li>`).join('')}
      </ul>
    `;

    // --- GAMIFICATION ---
    const gamificationWrapper = document.getElementById('gamification-wrapper');
    if(currentSavings > 0 && target > 0) {
      const percent = Math.min(100, Math.round((currentSavings / target) * 100));
      document.getElementById('prog-target').innerText = formatIDR(target);
      document.getElementById('prog-current').innerText = formatIDR(currentSavings);
      document.getElementById('prog-percent').innerText = percent + "%";
      
      // Animate progress bar
      setTimeout(() => { 
        document.getElementById('prog-bar').style.width = percent + "%"; 
      }, 100);
      
      gamificationWrapper.style.display = 'block';
    } else {
      gamificationWrapper.style.display = 'none';
    }

    // --- STRATEGY ---
    const strategyWrapper = document.getElementById('strategy-wrapper');
    const needsMonthly = Math.ceil(income * 0.7);
    const savingsMonthly = income - needsMonthly - debt;
    const savingsPercent = Math.round((savingsMonthly / income) * 100);
    
    let strategyTitle = ""; 
    let strategyContent = ""; 
    let strategyColor = ""; 
    let strategyIcon = ""; 
    let debtAdvice = "";
    let hustleTips = [];

    if (savingsPercent < 10) {
      strategyTitle = "Level Pemula"; 
      strategyIcon = "üå±"; 
      strategyContent = "Mulailah dari Rp 50rb saja dulu."; 
      strategyColor = "var(--info-bg)";
    } else if (savingsPercent >= 30) {
      strategyTitle = "Level Sultan"; 
      strategyIcon = "üöÄ"; 
      strategyContent = "Luar biasa! Standar Gold Standard."; 
      strategyColor = "var(--success-bg)";
    } else {
      strategyTitle = "Level Aman"; 
      strategyIcon = "üìà"; 
      strategyContent = "Coba tantang diri menaikkan 5% lagi."; 
      strategyColor = "#fffbeb";
    }

    if (debt > 0 && aman > debt) {
      debtAdvice = `
        <div style="margin-top:8px; padding:8px; background:white; border-radius:6px; font-size:12px; color:#b91c1c; border-left:3px solid #ef4444;">
          üí° <strong>DEBT DESTROYER:</strong> Lunasi utang sekarang hemat jutaan bunga!
        </div>`;
    }

    const dreamType = document.getElementById('dreamType').value;
    hustleTips = hustleDB[dreamType] || hustleDB['none'];
  
    let hustleHTML = "";
    if(hustleTips.length > 0) {
      const randomHustles = [...hustleTips].sort(() => 0.5 - Math.random()).slice(0, 6);
      hustleHTML = `
        <div style="margin-top:10px;">
          <div style="font-size:10px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Ide Side Hustle (Relevan):</div>
          <div class="hustle-container">
            ${randomHustles.map(t => `<span class="hustle-tag">${t}</span>`).join('')}
          </div>
        </div>`;
    }

    strategyWrapper.innerHTML = `
      <div class="info-box" style="background:${strategyColor}; border-color:transparent; margin-top:16px;">
        <div class="info-header">
          <div class="info-title">Strategi Keuanganmu</div>
          <div style="font-size:12px; font-weight:800; color:#64748b;">${savingsPercent}% Tabungan</div>
        </div>
        <div style="font-size:18px; font-weight:800; margin:4px 0;">${strategyIcon} ${strategyTitle}</div>
        <div class="info-desc" style="font-size:13px; line-height:1.5;">${strategyContent}</div>
        ${debtAdvice}
        ${hustleHTML}
      </div>
    `;

    // --- DREAM PLANNER ---
    const dreamWrapper = document.getElementById('dream-result-wrapper');
    const dreamMethod = document.getElementById('dreamMethod').value;
    const dpInput = document.getElementById('dpPercent').value;
    const tenorInput = document.getElementById('tenorYears').value;
    const rateInput = document.getElementById('interestRate').value;
    let dreamHTML = "";
    
    if(dreamType !== 'none' && dreamPrice > 0) {
      let dpPercent = 20; 
      let isCreditRisky = false;
      let kreditHTML = "";

      if(dreamMethod === 'kredit') {
        dpPercent = parseInt(dpInput) || 20;
        const principal = dreamPrice * (1 - dpPercent/100);
        const rate = (parseInt(rateInput) || 12) / 100;
        const years = parseInt(tenorInput) || 3;
        const months = years * 12;
        
        const totalInterest = principal * rate * years;
        const totalPay = principal + totalInterest;
        const monthlyInstallment = totalPay / months;

        const maxInstallment = income * 0.3;
        isCreditRisky = monthlyInstallment > maxInstallment;

        kreditHTML = `
          <div style="background:var(--bg-body); padding:10px; border-radius:8px; margin-top:10px; border:1px solid var(--border);">
            <div style="font-size:11px; font-weight:700; color:var(--text-muted); margin-bottom:4px;">RINCIAN KREDIT (FLAT RATE)</div>
            <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:2px;">
              <span>Pokok (Plafon):</span>
              <span>Rp ${formatIDR(principal)}</span>
            </div>
            <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:2px;">
              <span>Bunga:</span>
              <span style="color:var(--danger);">Rp ${formatIDR(totalInterest)}</span>
            </div>
            <div style="display:flex; justify-content:space-between; font-size:12px; margin-top:4px; border-top:1px dashed var(--border); padding-top:4px; font-weight:700;">
              <span>Cicilan/bulan:</span>
              <span style="font-size:14px;">Rp ${formatIDR(monthlyInstallment)}</span>
            </div>
          </div>
          <div style="margin-top:10px; padding:8px; border-radius:6px; font-size:12px; background:${isCreditRisky ? 'var(--danger-bg)' : 'var(--success-bg)'}; border-left:4px solid ${isCreditRisky ? 'var(--danger)' : 'var(--success)'};">
            ${isCreditRisky ? '‚ö†Ô∏è <strong>BERBAHAYA!</strong> Cicilan melebihi 30% Gaji.' : '‚úÖ <strong>AMAN DICICIL</strong>'}
          </div>
        `;
      }

      let needed = (dreamMethod === 'tunai') ? dreamPrice : (dreamPrice * dpPercent / 100);
      let status = aman >= needed; 
      let label = status ? 'CUKUP AMAN' : 'BELUM CUKUP';
      let msg = "";
      
      if(!status) {
        const deficit = needed - aman;
        let itemText = "Dana Aman";
        if (dreamMethod === 'tunai') itemText = "Pelunasan Tunai";
        else if (dreamMethod === 'kredit') itemText = "Uang Muka (DP)";
        msg = `Kurang <strong>Rp ${formatIDR(deficit)}</strong> untuk ${itemText} ${dreamType.toUpperCase()}.`;
      } else {
        msg = `Selamat! Dana Amanmu (${formatIDR(aman)}) cukup.`;
      }

      dreamHTML = `
        <div class="dream-result-card">
          <div class="info-header">
            <div class="info-title">üèÜ Cek Mimpi: ${dreamType.toUpperCase()}</div>
            <span class="info-tag">${dreamMethod.toUpperCase()} ${dreamMethod==='kredit'?`(${dpPercent}% DP)`:''}</span>
          </div>
          <div style="font-size:14px; color:var(--text-muted); margin-top:4px;">Harga Cash</div>
          <div style="font-size:22px; font-weight:800; color:var(--text-main);">Rp ${formatIDR(dreamPrice)}</div>
          <div style="font-size:13px; color:var(--text-muted); margin-top:4px;">Kebutuhan Dana Tunai ${dreamMethod==='kredit'?'(DP)':'(Lunas)'}</div>
          <div style="font-size:16px; font-weight:700; color:var(--text-main); margin-bottom:8px;">Rp ${formatIDR(needed)}</div>
          
          ${kreditHTML}

          <div class="dream-status-badge ${status?'status-success':'status-fail'}">${label}</div>
          <div style="font-size:13px; color:var(--text-muted); text-align:center; margin-top:8px;">${msg}</div>
        </div>`;
    }
    dreamWrapper.innerHTML = dreamHTML;

    // --- MONTHLY ANALYSIS ---
    document.getElementById('cash-income').innerText = "Rp " + formatIDR(income);
    document.getElementById('cash-needs').innerText = formatIDR(needsMonthly) + ` (${Math.round((needsMonthly/income)*100)}%)`;
    document.getElementById('cash-debt').innerText = formatIDR(debt) + ` (${Math.round((debt/income)*100)}%)`;
    const actualSave = income - needsMonthly - debt;
    document.getElementById('cash-save').innerText = formatIDR(actualSave) + ` (${Math.round((actualSave/income)*100)}%)`;

    // --- DETAILED CARDS ---
    document.getElementById('buffer-price').innerText = "Rp " + formatIDR(buffer);
    document.getElementById('target-price-detail').innerText = "Rp " + formatIDR(target);
    document.getElementById('inflation-alert').innerHTML = inflationHTML;
    
    const lifestyleText = lifestyleVal.charAt(0).toUpperCase() + lifestyleVal.slice(1);
    document.getElementById('lifestyle-tag-detail').innerText = lifestyleText;
    document.getElementById('lifestyle-text').innerText = lifestyleText;
    
    const reasonLists = {
      nikah: ["Biaya KUA & Legalitas", "Mahar/Seserahan", "Dekorasi & Catering", "Busana & MUA", "Gedung/Tenda", "Dokumentasi", "Souvenir", "Amplop", "Pindahan", "Dana Darurat"],
      hamil: ["Kontrol & USG", "Suplemen & Vitamin", "Biaya Persalinan RS", "Dokter Spesialis", "Stok Perlengkapan Bayi", "Stok Popok (NB-S)", "Stok Susu", "Biaya Perawatan Ibu", "Dana Darurat"],
      anak: ["Susu Formula", "Makanan Pendamping", "Pampers", "Imunisasi", "Dokter Anak", "Sekolah", "Transportasi", "Pakaian", "Mainan", "Dana Sakit"]
    };
    
    const listHTML = (reasonLists[statusVal] || []).map(item => `<li>${item}</li>`).join('');
    document.getElementById('budget-list-items').innerHTML = listHTML;

    // --- SAFE PRICE DETAILS ---
    document.getElementById('safe-price-detail').innerText = "Rp " + formatIDR(aman);

    // --- ACCOUNTING SUMMARY ---
    const totalAset = income + currentSavings;
    const totalBeban = target + debt;
    const netResult = totalAset - totalBeban;
    
    const accountingHTML = `
      <div style="text-align:center; margin-bottom:16px; font-weight:700; letter-spacing:1px; text-transform:uppercase;">Laporan Laba Rugi (Snapshot)</div>
      <div class="acc-row">
        <div class="acc-label">Total Aset (Masuk)</div>
        <div class="acc-val" id="acc-asset">Rp ${formatIDR(totalAset)}</div>
      </div>
      <div style="font-size:10px; color:#cbd5e1; text-align:right; padding:0 0 4px 0;">(Gaji + Tabungan)</div>
      <div class="acc-row">
        <div class="acc-label">Total Beban (Keluar)</div>
        <div class="acc-val" id="acc-liability">Rp ${formatIDR(totalBeban)}</div>
      </div>
      <div style="font-size:10px; color:#cbd5e1; text-align:right; padding:0 0 4px 0;">(Biaya Target + Total Utang)</div>
      <div class="acc-row acc-divider">
        <div class="acc-label">SURPLUS / DEFISIT</div>
        <div class="acc-val ${netResult >= 0 ? 'pos' : 'neg'}" id="acc-net-result">Rp ${formatIDR(netResult)}</div>
      </div>
    `;
    
    document.getElementById('accounting-wrapper').innerHTML = accountingHTML;

    // --- SOLUTIONS ---
    const solutionWrapper = document.getElementById('solution-wrapper');
    const solutionList = document.getElementById('solution-list-content');
    
    let solutions = [];
    let hustleDisplay = [];

    // Analysis paragraph
    let analysisText = `Berdasarkan data (${statusVal.toUpperCase()}, ${lifestyleVal.toUpperCase()}), Kebutuhan Anda mencapai <strong>Rp ${formatIDR(target)}</strong>. `;
    
    if (netResult < 0) {
      const deficit = Math.abs(netResult);
      solutions.push(`<strong>1. Selamatkan Defisit:</strong> Anda defisit <strong>Rp ${formatIDR(deficit)}</strong>. Solusi: Side Hustle.`);
      hustleDisplay = hustleTips.slice(0, 3).map(t => `<li>‚û°Ô∏è Buka usaha: <strong>${t}</strong></li>`);
    } else {
      solutions.push(`<strong>1. Posisi Kuat:</strong> Surplus <strong>Rp ${formatIDR(netResult)}</strong>. Gunakan untuk investasi.`);
      solutions.push(`<strong>2. Tingkatkan Kekayaan:</strong> Jangan simpan jika utang tinggi. Lunasi dulu.`);
      hustleDisplay = [`<li>üí° Opsional: Side Hustle - <em>${hustleTips[0] || 'Freelance'}</em></li>`];
    }

    if (debt > 0) {
      solutions.push(`<strong>${solutions.length + 1}. Utang Prioritas:</strong> Lunasi utang sebelum menabung.`);
    }
    
    if (statusVal === 'nikah' && dreamType === 'none') {
      solutions.push(`<strong>${solutions.length + 1}. Fokus Target:</strong> Arahkan dana ke Mahar/Emas.`);
    }

    solutionList.innerHTML = `
      <li>${analysisText}</li>
      ${solutions.map(s => `<li>${s}</li>`).join('')}
      ${hustleDisplay.join('')}
    `;

    // --- TARGET PLAN ---
    const dateInput = document.getElementById('targetDate').value;
    const planCard = document.getElementById('target-plan-card');
    
    if(dateInput) {
      planCard.style.display = 'block';
      const targetDate = new Date(dateInput);
      const today = new Date();
      
      // Calculate months difference
      const diffMonths = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24 * 30)));
      const perMonth = diffMonths > 0 ? Math.ceil(aman / diffMonths) : 0;
      const daily = Math.ceil(perMonth / 30);
      const weekly = Math.ceil(perMonth / 4);
      
      let contextText = "";
      if (daily < 10000) contextText = "Setara pulsa reguler.";
      else if (daily < 25000) contextText = "Setara rokok ringan.";
      else if (daily < 50000) contextText = "Setara kopi susu.";
      else if (daily < 100000) contextText = "Setara bensin motor.";
      else contextText = "Setara makan siang.";

      document.getElementById('plan-date').innerText = targetDate.toLocaleDateString('id-ID');
      document.getElementById('plan-months').innerText = diffMonths + " Bulan";
      document.getElementById('plan-daily').innerText = "Rp " + formatIDR(daily);
      document.getElementById('plan-weekly').innerText = "Rp " + formatIDR(weekly);
      document.getElementById('plan-context').innerText = contextText;
      document.getElementById('plan-monthly').innerText = "Rp " + formatIDR(perMonth) + " / bln";
      
      const compBox = document.getElementById('plan-comparison-box');
      if (perMonth <= actualSave) {
          const surplus = actualSave - perMonth;
          compBox.innerHTML = `<div style="color:var(--success-dark); font-weight:700;">‚úÖ TARGET SANTAI (Sisa: Rp ${formatIDR(surplus)}/bln)</div>`;
          compBox.style.background = "var(--success-bg)"; 
          compBox.style.border = "1px solid #a7f3d0";
      } else {
          const deficit = perMonth - actualSave;
          compBox.innerHTML = `<div style="color:var(--danger); font-weight:700;">‚ö†Ô∏è PERLU KERJA (Kurang: Rp ${formatIDR(deficit)}/bln)</div>`;
          compBox.style.background = "var(--danger-bg)"; 
          compBox.style.border = "1px solid #fecaca";
      }
    } else {
      planCard.style.display = 'none';
    }

    // --- TRANSITION UI ---
    document.getElementById('input-section').classList.add('hidden');
    document.getElementById('unlock-btn').classList.remove('hidden');
    document.getElementById('btn-calc').classList.add('hidden');
    document.getElementById('initial-msg').classList.add('hidden');
    document.getElementById('detail-container').classList.remove('hidden');
    
    // --- GET GOLD PRICE ASYNC ---
    getHargaEmas().then(price => {
      const goldPrice = price || 1000000; // Fallback if API fails
      const goldGrams = (aman / goldPrice).toFixed(2);
      
      document.getElementById('gold-price-detail').innerText = "Rp " + formatIDR(goldPrice);
      document.getElementById('gram-detail').innerText = goldGrams + " gram";
      document.getElementById('emas').innerText = goldGrams + " gram";
    });

    // Restore button
    btn.disabled = false; 
    btnText.innerText = originalText;
    
    // Scroll to results on mobile
    if(window.innerWidth < 768) {
      setTimeout(() => {
        document.getElementById('result-section').scrollIntoView({behavior:'smooth', block: 'start'});
      }, 300);
    }

  } catch(err) {
    console.error("Critical Error:", err);
    alert("Terjadi kesalahan sistem. Silakan coba lagi atau refresh halaman.");
    
    const btn = document.getElementById('btn-calc');
    const btnText = document.getElementById('btn-text');
    btn.disabled = false; 
    btnText.innerText = "ANALISIS KEAMANAN SAYA";
  }
}
</script>
</body>
</html>
