<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HONORER DIGITAL</title>
    <!-- FONT -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- CHART JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- ICONS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
/* ===== DESIGN SYSTEM ===== */
:root {
    --primary: #1a56db;
    --primary-dark: #1e429f;
    --primary-gradient: linear-gradient(135deg, #1a56db 0%, #1e429f 100%);
    --success: #047857;
    --success-bg: #d1fae5;
    --danger: #dc2626;
    --danger-bg: #fee2e2;
    --warning: #d97706;
    --warning-bg: #fef3c7;
    --info: #0ea5e9;
    --info-bg: #e0f2fe;
    --gray-50: #f8fafc;
    --gray-100: #f1f5f9;
    --gray-200: #e2e8f0;
    --gray-300: #cbd5e1;
    --gray-400: #94a3b8;
    --gray-500: #64748b;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1e293b;
    --gray-900: #0f172a;
    --icon-color: #475569;
    --bg-body: var(--gray-50);
    --bg-card: #ffffff;
    --text-main: var(--gray-900);
    --text-muted: var(--gray-600);
    --text-light: var(--gray-400);
    --border: var(--gray-200);
    --radius-xl: 20px;
    --radius-lg: 12px;
    --radius-md: 8px;
    --shadow-soft: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
    --shadow-medium: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
}

* { 
    box-sizing: border-box; 
    -webkit-tap-highlight-color: transparent; 
    outline: none; 
}

body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    margin: 0;
    padding: 16px;
    min-height: 100vh;
    line-height: 1.5;
}

/* ===== HEADER ===== */
.header {
    text-align: center; 
    margin-bottom: 24px; 
    padding: 20px 0;
}

.header-title {
    font-size: 28px; 
    font-weight: 800; 
    color: var(--text-main); 
    margin: 0 0 8px 0;
}

.header-subtitle {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 12px;
}

.status-badge {
    display: inline-flex; 
    align-items: center; 
    gap: 8px; 
    padding: 8px 16px;
    background: var(--bg-card); 
    border: 1px solid var(--border); 
    border-radius: 50px;
    font-size: 12px; 
    font-weight: 600; 
    color: var(--text-muted);
}

.status-dot { 
    width: 8px; 
    height: 8px; 
    border-radius: 50%; 
    background-color: var(--gray-400);
}

.status-dot.online { 
    background-color: var(--success); 
}

/* ===== LAYOUT ===== */
.container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
}

@media (min-width: 992px) {
    .container { 
        grid-template-columns: 1fr 1fr; 
        gap: 24px;
    }
}

/* ===== CARDS ===== */
.card {
    background: var(--bg-card); 
    border-radius: var(--radius-xl); 
    padding: 24px;
    box-shadow: var(--shadow-soft);
    border: 1px solid var(--border);
}

/* ===== INPUT SECTIONS ===== */
.section-title {
    font-size: 18px; 
    font-weight: 700; 
    color: var(--text-main); 
    margin: 0 0 20px 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-title i {
    color: var(--icon-color);
    font-size: 18px;
}

.form-group { 
    margin-bottom: 20px; 
}

.form-label { 
    font-size: 14px; 
    font-weight: 600; 
    color: var(--text-main); 
    margin-bottom: 8px; 
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-label i {
    color: var(--icon-color);
    font-size: 14px;
}

.input-row { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 16px; 
}

@media (max-width: 768px) {
    .input-row {
        grid-template-columns: 1fr;
    }
}

.form-input {
    width: 100%; 
    padding: 12px 16px; 
    font-size: 16px; 
    font-family: inherit;
    color: var(--text-main); 
    background: var(--bg-card); 
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    transition: all 0.2s ease;
}

.form-input:focus { 
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 0 3px rgba(26, 86, 219, 0.1);
}

.form-select {
    width: 100%; 
    padding: 12px 16px; 
    font-size: 16px; 
    font-family: inherit;
    color: var(--text-main); 
    background: var(--bg-card); 
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    appearance: none; 
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23475569'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 20px;
}

/* ===== PERIODE TABUNGAN ===== */
.period-section {
    margin: 20px 0;
}

.period-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 12px;
}

.period-btn {
    padding: 16px 12px;
    background: var(--gray-100);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-md);
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    color: var(--gray-700);
    transition: all 0.2s ease;
}

.period-btn:hover {
    background: var(--gray-200);
}

.period-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

/* ===== KREDIT CARD SECTION ===== */
.credit-card {
    background: var(--warning-bg);
    padding: 20px;
    border-radius: var(--radius-lg);
    border-left: 4px solid var(--warning);
    margin: 16px 0;
}

.credit-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.credit-title {
    font-weight: 600;
    color: var(--gray-800);
    display: flex;
    align-items: center;
    gap: 10px;
}

.credit-amount {
    font-weight: 700;
    color: var(--gray-800);
}

/* ===== INFLATION TOGGLE ===== */
.toggle-section {
    background: var(--bg-card);
    padding: 20px;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
    margin: 20px 0;
}

.toggle-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.toggle-label {
    font-weight: 600;
    color: var(--text-main);
    display: flex;
    align-items: center;
    gap: 10px;
}

.switch {
    position: relative;
    display: inline-block;
    width: 52px;
    height: 28px;
}

.switch input { 
    opacity: 0;
    width: 0;
    height: 0;
}

.switch-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--gray-300);
    border-radius: 34px;
    transition: .4s;
}

.switch-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    border-radius: 50%;
    transition: .4s;
}

input:checked + .switch-slider {
    background-color: var(--primary);
}

input:checked + .switch-slider:before {
    transform: translateX(24px);
}

.toggle-status {
    font-size: 14px;
    color: var(--text-muted);
    text-align: center;
    padding: 8px;
    border-radius: var(--radius-md);
    margin-top: 12px;
}

.toggle-status.on {
    color: var(--success);
    background: var(--success-bg);
}

.toggle-status.off {
    color: var(--danger);
    background: var(--danger-bg);
}

/* ===== BUTTONS ===== */
.btn-primary {
    width: 100%;
    padding: 16px;
    background: var(--primary-gradient);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(26, 86, 219, 0.2);
}

.btn-secondary {
    width: 100%;
    padding: 14px;
    background: white;
    color: var(--text-muted);
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    font-weight: 600;
    cursor: pointer;
    margin-top: 12px;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.btn-secondary:hover {
    border-color: var(--primary);
    color: var(--primary);
}

/* ===== GOLD PRICE ===== */
.gold-price-section {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    padding: 20px;
    border-radius: var(--radius-lg);
    text-align: center;
    margin-bottom: 24px;
    border: 1px solid #fbbf24;
}

.gold-price-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.gold-price-value {
    font-size: 32px;
    font-weight: 800;
    color: var(--warning);
    margin: 8px 0;
}

.gold-price-note {
    font-size: 12px;
    color: var(--gray-600);
}

/* ===== CHART SECTION ===== */
.chart-section {
    margin-bottom: 24px;
}

.chart-container {
    position: relative;
    height: 300px;
    width: 100%;
    margin: 16px 0;
}

.line-chart-container {
    position: relative;
    height: 300px;
    width: 100%;
    margin: 20px 0;
    background: white;
    border-radius: var(--radius-lg);
    padding: 20px;
    border: 1px solid var(--border);
}

/* ===== RESULTS ===== */
.result-hero {
    text-align: center;
    margin-bottom: 32px;
}

.result-label {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 8px;
    font-weight: 600;
}

.result-value {
    font-size: 40px;
    font-weight: 800;
    color: var(--text-main);
    margin: 16px 0;
}

.result-sub {
    font-size: 14px;
    color: var(--success);
    font-weight: 600;
    display: inline-block;
    padding: 8px 16px;
    background: var(--success-bg);
    border-radius: 20px;
}

/* ===== INFO CARDS ===== */
.info-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    margin: 24px 0;
}

@media (min-width: 768px) {
    .info-grid {
        grid-template-columns: 1fr 1fr;
    }
}

.info-card {
    background: var(--bg-card);
    padding: 20px;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
}

.info-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.info-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 8px;
}

.info-badge {
    font-size: 11px;
    padding: 4px 10px;
    border-radius: 12px;
    font-weight: 700;
}

.info-amount {
    font-size: 24px;
    font-weight: 800;
    color: var(--text-main);
    margin: 8px 0;
}

.info-desc {
    font-size: 14px;
    color: var(--text-muted);
    line-height: 1.5;
}

/* ===== DREAM PLANNER ===== */
.dream-section {
    background: var(--gray-900);
    color: white;
    padding: 24px;
    border-radius: var(--radius-lg);
    margin: 24px 0;
}

.dream-section label,
.dream-section .form-label,
.dream-section .info-title {
    color: var(--gray-300);
}

.dream-section .form-input,
.dream-section .form-select {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.2);
    color: white;
}

.dream-section .form-input:focus,
.dream-section .form-select:focus {
    border-color: var(--primary);
}

/* ===== ACCOUNTING SUMMARY ===== */
.accounting-box {
    background: var(--gray-900);
    color: white;
    padding: 24px;
    border-radius: var(--radius-lg);
    margin: 24px 0;
}

.accounting-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.accounting-label {
    font-size: 14px;
    color: var(--gray-300);
}

.accounting-value {
    font-size: 16px;
    font-weight: 700;
    color: white;
}

.accounting-value.positive {
    color: #34d399;
}

.accounting-value.negative {
    color: #fca5a5;
}

/* ===== UTILITIES ===== */
.hidden { 
    display: none !important; 
}

.text-center { text-align: center; }
.mb-16 { margin-bottom: 16px; }
.mt-16 { margin-top: 16px; }
.mt-24 { margin-top: 24px; }

/* ===== FOOTER ===== */
.footer {
    text-align: center;
    padding: 24px 0;
    color: var(--text-muted);
    font-size: 13px;
    border-top: 1px solid var(--border);
    margin-top: 40px;
}

/* ===== SCROLL TOP ===== */
.scroll-top {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 48px;
    height: 48px;
    background: var(--primary-gradient);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: var(--shadow-medium);
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
    z-index: 1000;
}

.scroll-top.visible {
    opacity: 1;
    transform: translateY(0);
}

/* ===== CREDIT INFO BOX ===== */
.credit-info-box {
    background: var(--info-bg);
    padding: 16px;
    border-radius: var(--radius-md);
    border-left: 4px solid var(--info);
    margin-top: 16px;
    font-size: 13px;
    color: var(--gray-700);
}

.credit-info-box strong {
    color: var(--info);
}

/* ===== MOBILE OPTIMIZATION ===== */
@media (max-width: 768px) {
    .container {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .card {
        padding: 20px;
    }
    
    .period-buttons {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    .period-btn {
        padding: 12px 8px;
        font-size: 13px;
    }
    
    .chart-container,
    .line-chart-container {
        height: 250px;
    }
    
    .result-value {
        font-size: 32px;
    }
    
    .info-amount {
        font-size: 22px;
    }
}
</style>
</head>
<body>

<div class="container">
    
    <!-- HEADER -->
    <div class="header">
        <h1 class="header-title">HONORER DIGITAL</h1>
        <p class="header-subtitle">Kalkulator Keamanan Finansial</p>
        <div class="status-badge">
            <span class="status-dot online"></span>
            <span id="api-status">Harga emas real-time</span>
        </div>
    </div>

    <!-- LEFT COLUMN: INPUT -->
    <div class="card" id="input-section">
        <h2 class="section-title"><i class="fas fa-calculator"></i> Data Keuangan</h2>
        
        <!-- PENGHASILAN -->
        <div class="input-row">
            <div class="form-group">
                <label class="form-label"><i class="fas fa-money-bill-wave"></i> Gaji Pokok</label>
                <input type="text" class="form-input" id="gaji-pokok" placeholder="Contoh: 5.000.000" inputmode="numeric">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-briefcase"></i> Penghasilan Tambahan</label>
                <input type="text" class="form-input" id="side-job" placeholder="Opsional" inputmode="numeric">
            </div>
        </div>

        <!-- STATUS KEHIDUPAN -->
        <div class="form-group">
            <label class="form-label"><i class="fas fa-user"></i> Status Keuangan</label>
            <select class="form-select" id="status">
                <option value="nikah">Akan Menikah</option>
                <option value="hamil">Persiapan Hamil</option>
                <option value="anak">Sudah Punya Anak</option>
            </select>
        </div>

        <!-- TARGET TANGGAL -->
        <div class="form-group">
            <label class="form-label"><i class="fas fa-calendar-alt"></i> Target Tanggal</label>
            <input type="date" class="form-input" id="target-date">
        </div>

        <!-- GAYA HIDUP & UTANG -->
        <div class="input-row">
            <div class="form-group">
                <label class="form-label"><i class="fas fa-chart-line"></i> Pola Pengeluaran</label>
                <select class="form-select" id="lifestyle">
                    <option value="hemat">Hemat</option>
                    <option value="standar" selected>Standar</option>
                    <option value="mewah">Mewah</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-file-invoice"></i> Kewajiban Bulanan</label>
                <input type="text" class="form-input" id="kewajiban-bulanan" placeholder="Cicilan, utang" inputmode="numeric">
            </div>
        </div>

        <!-- PERIODE TABUNGAN -->
        <div class="period-section">
            <label class="form-label"><i class="fas fa-calendar-alt"></i> Periode Tampilan Grafik</label>
            <div class="period-buttons">
                <button type="button" class="period-btn" data-period="1">1 Bulan</button>
                <button type="button" class="period-btn" data-period="3">3 Bulan</button>
                <button type="button" class="period-btn active" data-period="6">6 Bulan</button>
                <button type="button" class="period-btn" data-period="12">12 Bulan</button>
            </div>
        </div>

        <!-- TABUNGAN SAAT INI -->
        <div class="form-group">
            <label class="form-label"><i class="fas fa-piggy-bank"></i> Tabungan Saat Ini</label>
            <input type="text" class="form-input" id="tabungan-saat-ini" placeholder="Opsional" inputmode="numeric">
        </div>

        <!-- TOGGLE INFLASI -->
        <div class="toggle-section">
            <div class="toggle-header">
                <div class="toggle-label"><i class="fas fa-chart-line"></i> Kalkulasi Inflasi</div>
                <label class="switch">
                    <input type="checkbox" id="inflation-toggle" checked>
                    <span class="switch-slider"></span>
                </label>
            </div>
            <div class="toggle-status on" id="toggle-status">ON - Inflasi 6% per tahun</div>
        </div>

        <!-- DREAM PLANNER -->
        <div class="dream-section">
            <h2 class="section-title"><i class="fas fa-bullseye"></i> Dream Planner</h2>
            
            <div class="input-row">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-home"></i> Jenis Aset</label>
                    <select class="form-select" id="dream-type">
                        <option value="none">-- Pilih Aset --</option>
                        <option value="mobil">Mobil</option>
                        <option value="motor">Motor</option>
                        <option value="rumah">Rumah</option>
                        <option value="gadget">Gadget</option>
                        <option value="liburan">Liburan</option>
                        <option value="haji">Haji</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-money-check"></i> Metode</label>
                    <select class="form-select" id="dream-method">
                        <option value="tunai">Tunai</option>
                        <option value="kredit">Kredit</option>
                    </select>
                </div>
            </div>

            <!-- CREDIT INFO BOX -->
            <div id="credit-info-box" class="credit-info-box hidden">
                <strong>Info Kredit:</strong> Pilih jenis aset untuk melihat info kredit
            </div>

            <div id="credit-options" class="hidden">
                <div class="input-row mt-16">
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-percentage"></i> DP (%)</label>
                        <input type="number" class="form-input" id="dp-percent" value="20" min="10" max="90">
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-clock"></i> Tenor (Tahun)</label>
                        <select class="form-select" id="tenor-years">
                            <option value="1">1 Tahun</option>
                            <option value="3">3 Tahun</option>
                            <option value="5" selected>5 Tahun</option>
                            <option value="10">10 Tahun</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-percentage"></i> Bunga (%/tahun)</label>
                    <input type="number" class="form-input" id="interest-rate" value="12" min="1" max="30">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fas fa-tag"></i> Harga Aset</label>
                <input type="text" class="form-input" id="dream-price" placeholder="Estimasi harga cash" inputmode="numeric">
            </div>
        </div>

        <!-- BUTTONS -->
        <button class="btn-primary" id="calculate-btn">
            <i class="fas fa-calculator"></i> Hitung Keamanan Finansial
        </button>
        
        <button class="btn-secondary hidden" id="edit-btn">
            <i class="fas fa-edit"></i> Edit Data
        </button>
    </div>

    <!-- RIGHT COLUMN: RESULTS -->
    <div class="card" id="result-section">
        
        <!-- GOLD PRICE -->
        <div class="gold-price-section">
            <div class="gold-price-title"><i class="fas fa-gem"></i> Harga Emas Terkini</div>
            <div class="gold-price-value" id="gold-price">Rp 1,000,000</div>
            <div class="gold-price-note">Update otomatis setiap 2 menit</div>
        </div>

        <!-- RESULT HERO -->
        <div class="result-hero">
            <div class="result-label">Dana Investasi Tercatat</div>
            <div class="result-value" id="gold-grams">0 gram</div>
            <div class="result-sub">Siap dikonversi ke emas</div>
        </div>

        <!-- DOUGHNUT CHART -->
        <div class="chart-section">
            <h2 class="section-title"><i class="fas fa-chart-pie"></i> Ringkasan Dana</h2>
            <div class="chart-container">
                <canvas id="finance-chart"></canvas>
            </div>
        </div>

        <!-- LINE CHART -->
        <div id="line-chart-container" class="line-chart-container hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> Progress Tabungan vs Target</h2>
                <span id="line-chart-period" style="background: var(--primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">6 Bulan</span>
            </div>
            <canvas id="line-chart-ketabrak"></canvas>
            <div style="text-align: center; margin-top: 16px; font-size: 12px; color: var(--danger); padding: 8px; background: var(--danger-bg); border-radius: var(--radius-md); border: 1px dashed var(--danger);">
                <i class="fas fa-exclamation-triangle"></i> Target harus "ketabrak" garis akumulasi
            </div>
        </div>

        <!-- INITIAL MESSAGE -->
        <div id="initial-message" class="text-center" style="padding: 40px 20px;">
            <div style="font-size: 48px; color: var(--gray-300); margin-bottom: 20px;">
                <i class="fas fa-calculator"></i>
            </div>
            <h3 style="color: var(--gray-600); margin-bottom: 12px;">Isi Data Keuangan</h3>
            <p style="color: var(--gray-500); max-width: 400px; margin: 0 auto;">
                Masukkan data keuangan Anda di kolom kiri untuk melihat analisis keamanan finansial dan simulasi kredit.
            </p>
        </div>

        <!-- DETAILED RESULTS -->
        <div id="detailed-results" class="hidden">
            
            <!-- PROGRESS TRACKING -->
            <div class="info-card" style="background: var(--info-bg); border-color: var(--info);">
                <div class="info-header">
                    <div class="info-title" style="color: var(--info);">
                        <i class="fas fa-chart-line"></i>
                        Progress Menabung
                    </div>
                    <span class="info-badge" style="background: var(--info); color: white;">Target</span>
                </div>
                <div style="font-size: 13px; margin-bottom: 8px; color: var(--text-muted);">
                    Estimasi Biaya: <span id="prog-target" style="font-weight: 700;">Rp 0</span> | 
                    Terkumpul: <span id="prog-current" style="font-weight: 700; color: var(--success);">Rp 0</span>
                </div>
                <div style="height: 10px; background: var(--gray-200); border-radius: 5px; overflow: hidden; margin: 12px 0;">
                    <div id="prog-bar" style="height: 100%; background: var(--primary-gradient); width: 0%; transition: width 1s ease;"></div>
                </div>
                <div style="text-align: center; margin-top: 12px;">
                    <div style="font-size: 14px; font-weight: 800; color: var(--text-main);">
                        Progress: <span id="prog-percent" style="color: var(--primary);">0%</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;" id="prog-gap">Kurang 100% untuk mencapai target</div>
                </div>
            </div>

            <!-- DREAM RESULT -->
            <div id="dream-result"></div>

            <!-- MONTHLY ANALYSIS -->
            <div class="info-card">
                <div class="info-header">
                    <div class="info-title" style="color: var(--info);">
                        <i class="fas fa-money-bill-wave"></i>
                        Alokasi Bulanan
                    </div>
                    <span class="info-badge tag-info">Pembagian Dana</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 12px; font-weight: 600; color: var(--text-main);">
                    Total Penghasilan: <span id="cash-income" style="color: var(--primary);">Rp 0</span>
                </div>
                
                <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px; margin-bottom:10px; padding:8px 0; border-bottom:1px solid var(--border);">
                    <span style="display:flex; align-items:center; gap:8px; color:var(--text-muted);">
                        <i class="fas fa-utensils"></i> Operasional Bulanan
                    </span>
                    <span id="cash-needs" style="font-weight:700;">0 (70%)</span>
                </div>
                
                <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px; margin-bottom:10px; padding:8px 0; border-bottom:1px solid var(--border);">
                    <span style="display:flex; align-items:center; gap:8px; color:var(--text-muted);">
                        <i class="fas fa-file-invoice"></i> Kewajiban
                    </span>
                    <span id="cash-debt" style="font-weight:700;">0 (0%)</span>
                </div>
                
                <div style="display:flex; justify-content:space-between; align-items:center; font-size:14px; margin-top:12px; padding:12px 0; border-top:2px dashed var(--border);">
                    <span style="font-weight:800; display:flex; align-items:center; gap:8px; color:var(--text-main);">
                        <i class="fas fa-piggy-bank"></i> Sisa Keuangan
                    </span>
                    <span id="cash-save" style="font-weight:800; color:var(--success); font-size:16px;">0 (0%)</span>
                </div>
            </div>

            <!-- INFO GRID -->
            <div class="info-grid">
                <!-- Operasional 3 Bulan -->
                <div class="info-card">
                    <div class="info-header">
                        <div class="info-title">
                            <i class="fas fa-shield-alt"></i>
                            Operasional 3 Bulan
                        </div>
                        <span class="info-badge tag-warning">Kategori 1</span>
                    </div>
                    <div class="info-amount" id="emergency-fund">Rp 0</div>
                    <div class="info-desc">
                        <strong>Uang operasional hidup 3 bulan ke depan.</strong>
                        <div style="margin-top:8px; font-size:12px; color:var(--warning);">
                            <i class="fas fa-info-circle"></i> 70% dari gaji = kebutuhan hidup
                        </div>
                    </div>
                </div>

                <!-- Estimasi Biaya -->
                <div class="info-card">
                    <div class="info-header">
                        <div class="info-title">
                            <i class="fas fa-bullseye"></i>
                            Estimasi Biaya
                        </div>
                        <span class="info-badge" id="lifestyle-tag-detail">Standar</span>
                    </div>
                    <div class="info-amount" id="target-price-detail">Rp 0</div>
                    <div id="inflation-alert"></div>
                    <div class="info-desc">Estimasi biaya dengan pola pengeluaran <span id="lifestyle-text" style="font-weight:700;">Standar</span>.</div>
                    <ul class="budget-list" id="budget-list-items" style="margin-top: 12px;"></ul>
                </div>

                <!-- Dana Investasi Emas -->
                <div class="info-card" style="background: var(--success-bg); border-color: #a7f3d0;">
                    <div class="info-header">
                        <div class="info-title">
                            <i class="fas fa-lock"></i>
                            Dana Investasi Emas
                        </div>
                        <span class="info-badge tag-success">Kategori 3</span>
                    </div>
                    <div class="info-amount" style="color: var(--success-dark);" id="safe-price-detail">Rp 0</div>
                    <div class="info-desc">Sisa dana setelah operasional dan estimasi biaya.</div>
                    <div style="margin-top:16px;">
                        <div style="font-size:13px; font-weight:700; color:var(--success-dark); margin-bottom:6px; display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-gem"></i> Setara emas: <span id="gram-detail">0</span> gram
                        </div>
                        <div style="font-size:13px; color:var(--success-dark); display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-coins"></i> Harga emas: <span id="gold-price-detail">Rp 0</span> / gram
                        </div>
                    </div>
                </div>
            </div>

            <!-- RINGKASAN KEUANGAN -->
            <div class="accounting-box">
                <h2 class="section-title" style="color: white;"><i class="fas fa-balance-scale"></i> Ringkasan Keuangan</h2>
                
                <div class="accounting-row">
                    <div class="accounting-label">Total Aset Lancar</div>
                    <div class="accounting-value" id="total-assets">Rp 0</div>
                </div>
                
                <div class="accounting-row">
                    <div class="accounting-label">Total Kewajiban</div>
                    <div class="accounting-value" id="total-liabilities">Rp 0</div>
                </div>
                
                <div class="accounting-row">
                    <div class="accounting-label">Saldo Bersih</div>
                    <div class="accounting-value" id="net-worth">Rp 0</div>
                </div>
                
                <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 12px; color: #cbd5e1;">Rasio Keuangan</div>
                    <div style="font-size: 20px; font-weight: 800; color: white;" id="financial-ratio">0.0</div>
                    <div style="font-size: 11px; color: #cbd5e1; margin-top: 4px;" id="ratio-explanation">Rasio Aset/Kewajiban</div>
                </div>
            </div>

            <!-- TARGET PLAN -->
            <div id="target-plan-card" class="info-card" style="margin-top:20px; background: white; border: 2px solid var(--primary);">
                <div class="info-header">
                    <div class="info-title" style="color:var(--primary-dark);">
                        <i class="fas fa-calendar-alt"></i>
                        Target Tanggal
                    </div>
                    <span class="info-badge" style="background:var(--primary-gradient); color:white;">Hitung Mundur</span>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; padding-bottom:12px; border-bottom:1px solid var(--border);">
                    <div style="font-weight:700; font-size:14px;">Target Tanggal:</div>
                    <div id="plan-date" style="font-weight:800; color:var(--text-main);">-</div>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                    <div style="font-weight:700; font-size:14px;">Sisa Waktu:</div>
                    <div id="plan-months" style="color:var(--danger); font-weight:800; font-size:18px;">0 Bulan</div>
                </div>
                
                <div style="background:#fffbeb; padding:16px; border-radius:10px; border:2px solid #fcd34d; margin-bottom:16px;">
                    <div style="font-size:13px; font-weight:800; color:#b45309; margin-bottom:12px; text-transform:uppercase; display:flex; align-items:center; gap:8px;">
                        <i class="fas fa-fire"></i> Langkah Nyata Harian
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px;">
                        <div style="text-align:center; padding:12px; background:white; border-radius:8px; border:1px solid #fcd34d;">
                            <div style="font-size:11px; color:#92400e; margin-bottom:6px;">Target Harian</div>
                            <div style="font-size:18px; font-weight:800; color:#92400e;" id="plan-daily">Rp 0</div>
                        </div>
                        <div style="text-align:center; padding:12px; background:white; border-radius:8px; border:1px solid #fcd34d;">
                            <div style="font-size:11px; color:#92400e; margin-bottom:6px;">Target Mingguan</div>
                            <div style="font-size:18px; font-weight:800; color:#92400e;" id="plan-weekly">Rp 0</div>
                        </div>
                    </div>
                    <div style="font-size:12px; color:#b45309; font-style:italic; text-align:center;" id="plan-context">Hemat dari pengeluaran rutin.</div>
                </div>

                <div style="border-top:2px dashed var(--border); padding-top:16px;">
                    <div style="font-size:14px; color:var(--text-muted); margin-bottom:8px;">Total yang harus disisihkan:</div>
                    <div style="font-size:24px; font-weight:900; color:var(--text-main); margin-bottom:12px;" id="plan-monthly">Rp 0 / bulan</div>
                    
                    <div id="plan-comparison-box" style="margin-top:12px; padding:12px; border-radius:8px; font-size:13px; line-height:1.5;"></div>
                </div>
            </div>

            <!-- TIPS KEUANGAN -->
            <div class="info-card" style="background:white; border: 2px solid var(--primary); margin-top: 20px;">
                <div class="info-header">
                    <div class="info-title" style="color:var(--primary-dark);">
                        <i class="fas fa-lightbulb"></i>
                        Tips Keuangan
                    </div>
                    <span class="info-badge" style="background:var(--primary-gradient); color:white;">Custom</span>
                </div>
                <ul class="solution-list" id="solution-list-content" style="margin: 0; padding: 0;"></ul>
                <div id="side-hustle-recommendations" style="margin-top: 20px;"></div>
            </div>

            <!-- NASIHAT HARIAN -->
            <div class="info-card" style="margin-top: 20px;">
                <div class="info-header">
                    <div class="info-title">
                        <i class="fas fa-graduation-cap"></i>
                        Nasehat Harian
                    </div>
                    <span class="info-badge">Untuk Anda</span>
                </div>
                <ul class="advice-list" id="advice-list-content" style="margin: 0; padding: 0;"></ul>
            </div>

            <!-- BACK BUTTON -->
            <button class="btn-secondary mt-24" id="back-btn">
                <i class="fas fa-arrow-left"></i> Kembali ke Kalkulator
            </button>
        </div>
    </div>
</div>

<!-- SCROLL TOP -->
<div class="scroll-top" id="scroll-top">
    <i class="fas fa-arrow-up"></i>
</div>

<!-- FOOTER -->
<div class="footer">
    <div>Honorer Digital • 2026</div>
</div>

<script>
// ========== GLOBAL VARIABLES ==========
let currentPeriod = 6;
let goldPrice = 1000000;
let goldChart = null;
let financeChart = null;
let lineChart = null;
let goldUpdateInterval = null;

// ========== FORMATTING FUNCTIONS ==========
function formatRupiah(amount) {
    if (!amount || isNaN(amount)) return 'Rp 0';
    return 'Rp ' + amount.toLocaleString('id-ID');
}

function parseRupiah(input) {
    if (!input) return 0;
    const numericString = input.toString().replace(/[^0-9]/g, '');
    return parseInt(numericString) || 0;
}

// ========== GOLD PRICE API (BINANCE + EXCHANGE RATE) ==========
async function updateGoldPrice() {
    const goldPriceElement = document.getElementById('gold-price');
    const apiStatus = document.getElementById('api-status');
    
    try {
        goldPriceElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memuat...';
        apiStatus.innerHTML = '<span class="status-dot"></span> Memuat harga emas...';
        
        // 1. Get PAXG price from Binance
        const goldRes = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT');
        const goldData = await goldRes.json();
        const priceInUSD = parseFloat(goldData.price);
        
        // 2. Get USD to IDR exchange rate
        const rateRes = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        const rateData = await rateRes.json();
        const usdToIdr = rateData.rates.IDR;
        
        // 3. Convert to price per gram (1 oz = 31.1035 grams)
        goldPrice = Math.round((priceInUSD * usdToIdr) / 31.1035);
        
        // Update UI
        goldPriceElement.textContent = formatRupiah(goldPrice);
        apiStatus.innerHTML = '<span class="status-dot online"></span> Harga emas real-time';
        
        // Save cache
        localStorage.setItem('gold_cache', JSON.stringify({
            price: goldPrice,
            timestamp: Date.now(),
            source: 'Binance PAXG'
        }));
        
        return goldPrice;
        
    } catch (error) {
        console.error('Error fetching gold price:', error);
        
        // Try cache
        const cache = localStorage.getItem('gold_cache');
        if (cache) {
            const cacheData = JSON.parse(cache);
            const cacheAge = Date.now() - cacheData.timestamp;
            
            if (cacheAge < 24 * 60 * 60 * 1000) { // 24 hours
                goldPrice = cacheData.price;
                goldPriceElement.textContent = formatRupiah(goldPrice);
                apiStatus.innerHTML = '<span class="status-dot"></span> Harga emas (data cache)';
                return goldPrice;
            }
        }
        
        // Fallback
        goldPrice = 1000000;
        goldPriceElement.textContent = formatRupiah(goldPrice);
        apiStatus.innerHTML = '<span class="status-dot"></span> Harga emas default';
        return goldPrice;
    }
}

// ========== TOGGLE INFLASI ==========
document.getElementById('inflation-toggle').addEventListener('change', function() {
    const statusElement = document.getElementById('toggle-status');
    
    if (this.checked) {
        statusElement.textContent = 'ON - Inflasi 6% per tahun';
        statusElement.className = 'toggle-status on';
    } else {
        statusElement.textContent = 'OFF - Tanpa inflasi';
        statusElement.className = 'toggle-status off';
    }
    
    localStorage.setItem('inflation_toggle', this.checked);
});

// ========== PERIODE TABUNGAN ==========
document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // Update UI
        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // Update variable
        currentPeriod = parseInt(this.dataset.period);
        document.getElementById('line-chart-period').textContent = currentPeriod + ' Bulan';
        
        // Save to localStorage
        localStorage.setItem('selected_period', currentPeriod);
        
        // Update line chart if exists
        if (window.lastCalculation) {
            createLineChart(
                window.lastCalculation.monthlySave,
                window.lastCalculation.aman,
                currentPeriod
            );
        }
    });
});

// ========== KREDIT INPUT FORMATTING ==========
document.getElementById('kewajiban-bulanan').addEventListener('input', function() {
    // Format input
    const value = parseRupiah(this.value);
    this.value = value.toLocaleString('id-ID');
    
    // Save to localStorage
    localStorage.setItem('kewajiban_amount', value);
});

// ========== DREAM PLANNER TOGGLE & AUTO-FILL ==========
document.getElementById('dream-method').addEventListener('change', function() {
    const creditOptions = document.getElementById('credit-options');
    const creditInfoBox = document.getElementById('credit-info-box');
    
    if (this.value === 'kredit') {
        creditOptions.classList.remove('hidden');
        creditInfoBox.classList.remove('hidden');
    } else {
        creditOptions.classList.add('hidden');
        creditInfoBox.classList.add('hidden');
    }
});

// CREDIT SIMULATION DATABASE
const creditSimulations = {
    mobil: {
        defaultDP: 20,
        defaultInterest: 9,
        defaultTenor: 5,
        description: "DP 20-30%, bunga 6-9%/tahun, tenor 1-7 tahun. Cicilan termasuk asuransi."
    },
    motor: {
        defaultDP: 20,
        defaultInterest: 8,
        defaultTenor: 3,
        description: "DP 10-30%, bunga 6-9%/tahun, tenor 1-3 tahun."
    },
    rumah: {
        defaultDP: 20,
        defaultInterest: 8.5,
        defaultTenor: 15,
        description: "KPR DP 10-30%, bunga fixed 2-5 tahun lalu floating."
    },
    gadget: {
        defaultDP: 0,
        defaultInterest: 3,
        defaultTenor: 1,
        description: "0% DP, bunga 0-6%/bulan flat, tenor 6-24 bulan."
    },
    liburan: {
        defaultDP: 10,
        defaultInterest: 2.5,
        defaultTenor: 1,
        description: "DP 10-30%, bunga bervariasi, tenor 3-12 bulan."
    },
    haji: {
        defaultDP: 30,
        defaultInterest: 7,
        defaultTenor: 5,
        description: "Pembiayaan syariah, DP 20-40%, margin 7-12%/tahun."
    }
};

// AUTO-FILL FUNCTION
document.getElementById('dream-type').addEventListener('change', function() {
    const product = this.value;
    const creditInfoBox = document.getElementById('credit-info-box');
    
    if (product !== 'none' && creditSimulations[product]) {
        const defaults = creditSimulations[product];
        
        // Auto-fill values
        document.getElementById('dp-percent').value = defaults.defaultDP;
        document.getElementById('interest-rate').value = defaults.defaultInterest;
        document.getElementById('tenor-years').value = defaults.defaultTenor;
        
        // Show info box
        creditInfoBox.innerHTML = `<strong>Info Kredit ${product.toUpperCase()}:</strong> ${defaults.description}`;
        creditInfoBox.classList.remove('hidden');
    } else {
        creditInfoBox.classList.add('hidden');
    }
});

// ========== INPUT FORMATTING ==========
const numericInputs = ['gaji-pokok', 'side-job', 'kewajiban-bulanan', 'dream-price', 'tabungan-saat-ini'];
numericInputs.forEach(id => {
    const input = document.getElementById(id);
    if (input) {
        input.addEventListener('input', function() {
            const value = parseRupiah(this.value);
            this.value = value.toLocaleString('id-ID');
        });
    }
});

// ========== CALCULATION FUNCTIONS ==========
function calculateFinancials() {
    // Get input values
    const gajiPokok = parseRupiah(document.getElementById('gaji-pokok').value);
    const sideJob = parseRupiah(document.getElementById('side-job').value);
    const kewajiban = parseRupiah(document.getElementById('kewajiban-bulanan').value);
    const tabunganSaatIni = parseRupiah(document.getElementById('tabungan-saat-ini').value);
    
    const totalIncome = gajiPokok + sideJob;
    
    if (gajiPokok <= 0) {
        alert('Masukkan gaji pokok yang valid');
        return null;
    }
    
    // Status and lifestyle multipliers
    const baseMult = { 'nikah':6, 'hamil':4, 'anak':3 };
    const lifestyleFactor = { 'hemat': 0.8, 'standar': 1.0, 'mewah': 1.5 };
    
    const statusVal = document.getElementById('status').value;
    const lifestyleVal = document.getElementById('lifestyle').value;
    const useInflation = document.getElementById('inflation-toggle').checked;
    
    // Calculate target (estimasi biaya)
    let target = Math.ceil(gajiPokok * baseMult[statusVal] * lifestyleFactor[lifestyleVal]);
    
    // Apply inflation if enabled
    if (useInflation) {
        const dateInput = document.getElementById('target-date').value;
        if (dateInput) {
            const targetDate = new Date(dateInput);
            const today = new Date();
            const years = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24 * 365)));
            
            if (years > 0) {
                target = Math.ceil(target * Math.pow(1.06, years));
            }
        }
    }
    
    // Calculate operational 3 months (70% rule)
    const operationalMonthly = Math.ceil(gajiPokok * 0.7);
    const operational3Months = operationalMonthly * 3;
    
    // Calculate safe fund for investment
    const safeFund = Math.max(0, target - operational3Months);
    
    // Calculate monthly breakdown
    const monthlyNeeds = operationalMonthly;
    const monthlyDebt = kewajiban;
    const monthlySavings = gajiPokok - monthlyNeeds - monthlyDebt;
    
    // Calculate gold equivalent
    const goldGrams = (safeFund / goldPrice).toFixed(2);
    
    // Accounting summary
    const totalAssets = tabunganSaatIni + operational3Months;
    const totalLiabilities = target + (kewajiban * 12);
    const netWorth = totalAssets - totalLiabilities;
    const financialRatio = totalLiabilities > 0 ? (totalAssets / totalLiabilities).toFixed(1) : '∞';
    
    return {
        totalIncome,
        gajiPokok,
        monthlyNeeds,
        monthlyDebt,
        monthlySavings,
        operational3Months,
        target,
        safeFund: Math.round(safeFund),
        goldGrams,
        tabunganSaatIni,
        totalAssets: Math.round(totalAssets),
        totalLiabilities: Math.round(totalLiabilities),
        netWorth: Math.round(netWorth),
        financialRatio,
        statusVal,
        lifestyleVal,
        useInflation
    };
}

// ========== DREAM PLANNER CALCULATION ==========
function calculateDreamPlan(results) {
    const dreamType = document.getElementById('dream-type').value;
    const dreamMethod = document.getElementById('dream-method').value;
    const dreamPrice = parseRupiah(document.getElementById('dream-price').value);
    
    if (dreamType === 'none' || dreamPrice <= 0) {
        return '';
    }
    
    let dreamHTML = '';
    
    if (dreamMethod === 'kredit') {
        // Kredit calculation
        const dpPercent = parseInt(document.getElementById('dp-percent').value) || 20;
        const tenorYears = parseInt(document.getElementById('tenor-years').value) || 5;
        const interestRate = parseInt(document.getElementById('interest-rate').value) || 12;
        
        const dpAmount = dreamPrice * (dpPercent / 100);
        const loanAmount = dreamPrice - dpAmount;
        const interest = interestRate / 100;
        const totalInterest = loanAmount * interest * tenorYears;
        const totalPayment = loanAmount + totalInterest;
        const monthlyPayment = totalPayment / (tenorYears * 12);
        
        // Risk assessment
        const monthlyIncome = results.gajiPokok;
        const paymentRatio = (monthlyPayment / monthlyIncome) * 100;
        const isRisky = paymentRatio > 30;
        
        dreamHTML = `
            <div class="info-card mt-24">
                <div class="info-header">
                    <div class="info-title"><i class="fas fa-home"></i> Simulasi Kredit ${dreamType.toUpperCase()}</div>
                    <div class="info-badge" style="background: ${isRisky ? 'var(--danger-bg)' : 'var(--success-bg)'}; 
                                                    color: ${isRisky ? 'var(--danger)' : 'var(--success)'};">
                        ${isRisky ? 'Risiko Tinggi' : 'Aman'}
                    </div>
                </div>
                
                <div style="margin: 16px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: var(--text-muted);">DP (${dpPercent}%)</span>
                        <span style="font-weight: 600;">${formatRupiah(dpAmount)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: var(--text-muted);">Pokok Pinjaman</span>
                        <span>${formatRupiah(loanAmount)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: var(--text-muted);">Total Bunga</span>
                        <span style="color: var(--danger); font-weight: 600;">${formatRupiah(totalInterest)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span style="color: var(--text-muted);">Total Bayar</span>
                        <span style="font-weight: 700;">${formatRupiah(totalPayment)}</span>
                    </div>
                    <div style="padding: 12px; background: var(--gray-100); border-radius: var(--radius-md);">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-weight: 600;">Cicilan per Bulan</span>
                            <span style="font-size: 18px; font-weight: 800; color: var(--primary);">
                                ${formatRupiah(Math.ceil(monthlyPayment))}
                            </span>
                        </div>
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                            (${tenorYears} tahun, ${paymentRatio.toFixed(1)}% dari penghasilan)
                        </div>
                    </div>
                </div>
            </div>
        `;
    } else {
        // Tunai calculation
        const canAfford = results.safeFund >= dreamPrice;
        
        dreamHTML = `
            <div class="info-card mt-24">
                <div class="info-header">
                    <div class="info-title"><i class="fas fa-home"></i> Pembelian Tunai ${dreamType.toUpperCase()}</div>
                    <div class="info-badge" style="background: ${canAfford ? 'var(--success-bg)' : 'var(--danger-bg)'}; 
                                                    color: ${canAfford ? 'var(--success)' : 'var(--danger)'};">
                        ${canAfford ? 'Cukup' : 'Kurang'}
                    </div>
                </div>
                
                <div style="text-align: center; padding: 16px 0;">
                    <div style="font-size: 32px; font-weight: 800; color: var(--text-main); margin-bottom: 8px;">
                        ${formatRupiah(dreamPrice)}
                    </div>
                    <div style="font-size: 14px; color: var(--text-muted);">
                        Dana Investasi: ${formatRupiah(results.safeFund)}
                    </div>
                    ${!canAfford ? `
                        <div style="margin-top: 12px; padding: 12px; background: var(--danger-bg); border-radius: var(--radius-md);">
                            <div style="font-weight: 600; color: var(--danger);">Kurang ${formatRupiah(dreamPrice - results.safeFund)}</div>
                            <div style="font-size: 12px; color: var(--danger); margin-top: 4px;">
                                Butuh ${Math.ceil((dreamPrice - results.safeFund) / results.monthlySavings)} bulan menabung
                            </div>
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
    }
    
    return dreamHTML;
}

// ========== CREATE CHARTS ==========
function createCharts(results) {
    // Doughnut Chart
    const chartCanvas = document.getElementById('finance-chart');
    
    if (financeChart) {
        financeChart.destroy();
    }
    
    financeChart = new Chart(chartCanvas, {
        type: "doughnut",
        data: {
            labels: ["Dana Investasi", "Operasional 3 Bulan"],
            datasets: [{
                data: [results.safeFund, results.operational3Months],
                backgroundColor: ["#10b981", "#fbbf24"],
                borderWidth: 0,
                hoverOffset: 8
            }]
        },
        options: {
            cutout: '70%',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        usePointStyle: true,
                        padding: 20
                    }
                }
            }
        }
    });
    
    // Line Chart
    createLineChart(results.monthlySavings, results.safeFund, currentPeriod);
}

function createLineChart(monthlySave, targetAmount, period) {
    const lineCanvas = document.getElementById('line-chart-ketabrak');
    const container = document.getElementById('line-chart-container');
    
    if (!monthlySave || monthlySave <= 0 || !targetAmount || targetAmount <= 0) {
        container.classList.add('hidden');
        return;
    }
    
    container.classList.remove('hidden');
    
    if (lineChart) {
        lineChart.destroy();
    }
    
    // Prepare data
    const labels = [];
    const accumulatedData = [];
    const targetData = [];
    
    let accumulated = 0;
    for (let i = 1; i <= period; i++) {
        labels.push(`Bulan ${i}`);
        accumulated += monthlySave;
        accumulatedData.push(accumulated);
        targetData.push(targetAmount);
    }
    
    lineChart = new Chart(lineCanvas, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Target Dana Investasi',
                    data: targetData,
                    borderColor: '#dc2626',
                    backgroundColor: 'rgba(220, 38, 38, 0.1)',
                    borderWidth: 3,
                    borderDash: [10, 5],
                    fill: false,
                    tension: 0
                },
                {
                    label: 'Akumulasi Tabungan',
                    data: accumulatedData,
                    borderColor: '#047857',
                    backgroundColor: 'rgba(4, 120, 87, 0.2)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.3
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            if (value >= 1000000) {
                                return 'Rp ' + (value / 1000000).toFixed(0) + 'jt';
                            }
                            return 'Rp ' + value.toLocaleString('id-ID');
                        }
                    }
                }
            }
        }
    });
    
    // "Ketabrak" effect if accumulated >= target
    if (accumulatedData[period-1] >= targetAmount) {
        setTimeout(() => {
            lineCanvas.style.boxShadow = '0 0 0 4px rgba(4, 120, 87, 0.3)';
            setTimeout(() => {
                lineCanvas.style.boxShadow = 'none';
            }, 1000);
        }, 2000);
    }
}

// ========== UPDATE UI FUNCTIONS ==========
function updateUI(results) {
    // Update main results
    document.getElementById('gold-grams').textContent = results.goldGrams + ' gram';
    document.getElementById('cash-income').textContent = formatRupiah(results.totalIncome);
    document.getElementById('cash-needs').textContent = formatRupiah(results.monthlyNeeds) + ' (70%)';
    document.getElementById('cash-debt').textContent = formatRupiah(results.monthlyDebt) + ` (${Math.round((results.monthlyDebt/results.totalIncome)*100)}%)`;
    document.getElementById('cash-save').textContent = formatRupiah(results.monthlySavings) + ` (${Math.round((results.monthlySavings/results.totalIncome)*100)}%)`;
    
    // Update info cards
    document.getElementById('emergency-fund').textContent = formatRupiah(results.operational3Months);
    document.getElementById('target-price-detail').textContent = formatRupiah(results.target);
    document.getElementById('safe-price-detail').textContent = formatRupiah(results.safeFund);
    document.getElementById('gram-detail').textContent = results.goldGrams + ' gram';
    document.getElementById('gold-price-detail').textContent = formatRupiah(goldPrice);
    
    // Update lifestyle tag
    const lifestyleText = results.lifestyleVal.charAt(0).toUpperCase() + results.lifestyleVal.slice(1);
    document.getElementById('lifestyle-tag-detail').textContent = lifestyleText;
    document.getElementById('lifestyle-text').textContent = lifestyleText;
    
    // Update inflation alert
    const inflationAlert = document.getElementById('inflation-alert');
    if (results.useInflation) {
        inflationAlert.innerHTML = `
            <div style="font-size:12px; color:var(--danger); background:var(--danger-bg); padding:8px 12px; border-radius:6px; display:inline-block; margin-bottom:8px;">
                <i class="fas fa-chart-line"></i> Dengan Inflasi 6%
            </div>`;
    } else {
        inflationAlert.innerHTML = '';
    }
    
    // Update budget list
    const reasonLists = {
        nikah: ["Biaya KUA & Legalitas", "Mahar/Seserahan", "Dekorasi & Catering", "Busana & MUA", "Gedung/Tenda", "Dokumentasi", "Souvenir", "Amplop", "Pindahan", "Dana Darurat"],
        hamil: ["Kontrol & USG", "Suplemen & Vitamin", "Biaya Persalinan RS", "Dokter Spesialis", "Stok Perlengkapan Bayi", "Stok Popok", "Stok Susu", "Biaya Perawatan Ibu", "Dana Darurat"],
        anak: ["Susu Formula", "Makanan Pendamping", "Pampers", "Imunisasi", "Dokter Anak", "Sekolah", "Transportasi", "Pakaian", "Mainan", "Dana Sakit"]
    };
    
    const listHTML = (reasonLists[results.statusVal] || []).map(item => `<li>${item}</li>`).join('');
    document.getElementById('budget-list-items').innerHTML = listHTML;
    
    // Update accounting
    document.getElementById('total-assets').textContent = formatRupiah(results.totalAssets);
    document.getElementById('total-liabilities').textContent = formatRupiah(results.totalLiabilities);
    
    const netWorthElement = document.getElementById('net-worth');
    netWorthElement.textContent = formatRupiah(results.netWorth);
    netWorthElement.className = results.netWorth >= 0 ? 'accounting-value positive' : 'accounting-value negative';
    
    document.getElementById('financial-ratio').textContent = results.financialRatio;
    
    // Ratio explanation
    let ratioExplanation = "";
    if (results.financialRatio === "∞") {
        ratioExplanation = "Tidak ada kewajiban - posisi sangat sehat";
    } else if (parseFloat(results.financialRatio) >= 2) {
        ratioExplanation = "Sangat sehat (aset 2x lipat kewajiban)";
    } else if (parseFloat(results.financialRatio) >= 1) {
        ratioExplanation = "Sehat (aset cukup untuk kewajiban)";
    } else if (parseFloat(results.financialRatio) >= 0.5) {
        ratioExplanation = "Perhatian (aset hanya setengah kewajiban)";
    } else {
        ratioExplanation = "Bahaya (aset kurang dari setengah kewajiban)";
    }
    document.getElementById('ratio-explanation').textContent = ratioExplanation;
    
    // Update progress tracking
    if (results.tabunganSaatIni > 0 && results.target > 0) {
        const percent = Math.min(100, Math.round((results.tabunganSaatIni / results.target) * 100));
        const gapPercent = 100 - percent;
        
        document.getElementById('prog-target').textContent = formatRupiah(results.target);
        document.getElementById('prog-current').textContent = formatRupiah(results.tabunganSaatIni);
        document.getElementById('prog-percent').textContent = percent + "%";
        document.getElementById('prog-gap').textContent = `Kurang ${gapPercent}% untuk mencapai target`;
        
        setTimeout(() => {
            document.getElementById('prog-bar').style.width = percent + "%";
        }, 100);
    }
    
    // Update target plan
    const dateInput = document.getElementById('target-date').value;
    if (dateInput) {
        const targetDate = new Date(dateInput);
        const today = new Date();
        const diffMonths = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24 * 30)));
        const perMonth = diffMonths > 0 ? Math.ceil(results.safeFund / diffMonths) : 0;
        const daily = Math.ceil(perMonth / 30);
        const weekly = Math.ceil(perMonth / 4);
        
        document.getElementById('plan-date').textContent = targetDate.toLocaleDateString('id-ID', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        document.getElementById('plan-months').textContent = diffMonths + " Bulan";
        document.getElementById('plan-daily').textContent = formatRupiah(daily);
        document.getElementById('plan-weekly').textContent = formatRupiah(weekly);
        document.getElementById('plan-monthly').textContent = formatRupiah(perMonth) + " / bulan";
        
        const compBox = document.getElementById('plan-comparison-box');
        if (perMonth <= results.monthlySavings) {
            const surplus = results.monthlySavings - perMonth;
            compBox.innerHTML = `<div style="color:var(--success-dark); font-weight:800; display:flex; align-items:center; gap:8px; font-size:14px;"><i class="fas fa-check-circle"></i> TARGET TERJANGKAU (Sisa: ${formatRupiah(surplus)}/bln)</div>`;
            compBox.style.background = "var(--success-bg)";
            compBox.style.border = "2px solid #a7f3d0";
        } else {
            const deficit = perMonth - results.monthlySavings;
            compBox.innerHTML = `<div style="color:var(--danger); font-weight:800; display:flex; align-items:center; gap:8px; font-size:14px;"><i class="fas fa-exclamation-triangle"></i> PERLU EKSTRA (Kurang: ${formatRupiah(deficit)}/bln)</div>`;
            compBox.style.background = "var(--danger-bg)";
            compBox.style.border = "2px solid #fecaca";
        }
    }
    
    // Update advice
    const adviceDB = {
        nikah: [
            "Utamakan Mahar dalam bentuk Emas sebagai investasi.",
            "Gunakan undangan digital untuk menghemat biaya.",
            "Catering nasi box lebih hemat dan tetap enak.",
            "Sewa dekorasi 'Backdrop Only' untuk efisiensi.",
            "Beli perlengkapan secukupnya, jangan semuanya baru."
        ],
        hamil: [
            "Cek fasilitas kelas 3 BPJS untuk persalinan.",
            "Stok popok saat promo besar-besaran.",
            "Vitamin dan nutrisi ibu adalah prioritas utama.",
            "ASI eksklusif bisa menghemat biaya susu formula.",
            "USG hanya saat diperlukan, hindari yang kosmetik."
        ],
        anak: [
            "Mainan edukasi lebih baik dari mainan mahal.",
            "Bekal makan dari rumah lebih sehat dan hemat.",
            "Susu UHT plain lebih baik untuk kesehatan gigi.",
            "Tukar baju dengan saudara untuk menghemat.",
            "Bimbing belajar sendiri lebih efektif dan gratis."
        ]
    };
    
    const tips = adviceDB[results.statusVal] || [
        "Prioritaskan kebutuhan dasar sebelum keinginan.",
        "Hindari utang konsumtif yang tidak produktif.",
        "Sisihkan minimal 10% dari penghasilan untuk tabungan.",
        "Evaluasi pengeluaran bulanan secara rutin.",
        "Buat rencana keuangan jangka pendek dan panjang."
    ];
    
    const shuffledTips = [...new Set(tips)].sort(() => 0.5 - Math.random()).slice(0, 5);
    const adviceHTML = shuffledTips.map(t => `<li><i class="fas fa-check" style="color:var(--success);"></i> ${t}</li>`).join('');
    document.getElementById('advice-list-content').innerHTML = adviceHTML;
    
    // Update solutions
    const solutionList = document.getElementById('solution-list-content');
    let solutions = [];
    
    if (parseFloat(results.financialRatio) >= 2 || results.totalLiabilities === 0) {
        solutions.push(`<li style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;"><i class="fas fa-check-circle" style="color: var(--success);"></i> <span><strong>Posisi Sangat Kuat:</strong> Aset 2x kewajiban. Pertimbangkan investasi.</span></li>`);
    } else if (parseFloat(results.financialRatio) >= 1) {
        solutions.push(`<li style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;"><i class="fas fa-check-circle" style="color: var(--success);"></i> <span><strong>Posisi Sehat:</strong> Aset cukup untuk kewajiban. Tingkatkan tabungan.</span></li>`);
    } else {
        const deficit = results.totalLiabilities - results.totalAssets;
        solutions.push(`<li style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;"><i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i> <span><strong>Perlu Perhatian:</strong> Kurang <strong>${formatRupiah(deficit)}</strong> untuk menutup kewajiban.</span></li>`);
    }
    
    // Debt advice
    if (results.monthlyDebt > 0) {
        const debtToIncomeRatio = (results.monthlyDebt / results.gajiPokok) * 100;
        if (debtToIncomeRatio > 30) {
            solutions.push(`<li style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;"><i class="fas fa-exclamation-circle" style="color: var(--danger);"></i> <span><strong>Utang Tinggi:</strong> Cicilan ${Math.round(debtToIncomeRatio)}% dari gaji. Prioritaskan pelunasan.</span></li>`);
        }
    }
    
    // Savings rate advice
    const savingsRate = (results.monthlySavings / results.gajiPokok) * 100;
    if (savingsRate < 10) {
        solutions.push(`<li style="margin-bottom: 10px; display: flex; align-items: flex-start; gap: 10px;"><i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> <span><strong>Tabungan Rendah:</strong> Hanya ${Math.round(savingsRate)}% dari gaji. Targetkan 20%.</span></li>`);
    }
    
    solutionList.innerHTML = solutions.join('');
    
    // Side hustle recommendations
    const sideHustleRecommendations = {
        lowSkill: [
            { name: "Ojek Online", earning: "Rp 100-200rb/hari", note: "Flexible waktu, modal motor" },
            { name: "Jualan Pulsa/Data", earning: "Rp 500-800rb/bulan", note: "Modal kecil, untung konsisten" },
            { name: "Admin Media Sosial", earning: "Rp 1-2jt/bulan", note: "Kerja remote, fleksibel" },
            { name: "Jasa Titip Belanja", earning: "Rp 300-500rb/bulan", note: "Dari rumah, modal aplikasi" },
            { name: "Jual Makanan Ringan", earning: "Rp 500rb-1jt/bulan", note: "Modal < Rp 500k" }
        ],
        mediumSkill: [
            { name: "Freelance Desain", earning: "Rp 2-5jt/project", note: "Butuh skill desain" },
            { name: "Tutor Privat", earning: "Rp 50-100rb/jam", note: "Mata pelajaran sekolah" },
            { name: "Jasa Service HP", earning: "Rp 500rb-2jt/bulan", note: "Butuh alat dan skill" },
            { name: "Konten Kreator", earning: "Rp 1-10jt/bulan", note: "Butuh konsistensi" },
            { name: "Dropshipper", earning: "Rp 1-3jt/bulan", note: "Tanpa stok barang" }
        ]
    };
    
    const hustles = results.totalIncome <= 5000000 ? sideHustleRecommendations.lowSkill : sideHustleRecommendations.mediumSkill;
    const hustleHTML = `
        <div style="margin-top: 20px; border-top: 2px solid var(--border); padding-top: 16px;">
            <div style="font-weight: 800; color: var(--primary-dark); margin-bottom: 12px; font-size: 15px; display:flex; align-items:center; gap:8px;">
                <i class="fas fa-briefcase"></i> 5 Ide Tambah Penghasilan:
            </div>
            <div style="display: grid; gap: 10px;">
                ${hustles.slice(0, 5).map((h, i) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; 
                                padding: 12px; background: white; border-radius: 8px; border-left: 4px solid var(--primary); border: 1px solid var(--border);">
                        <div>
                            <strong style="font-size: 14px;">${i+1}. ${h.name}</strong>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">${h.note}</div>
                        </div>
                        <div style="font-size: 13px; font-weight: 800; color: var(--success); background: var(--success-bg); padding: 6px 10px; border-radius: 6px;">
                            ${h.earning}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    
    document.getElementById('side-hustle-recommendations').innerHTML = hustleHTML;
}

// ========== MAIN CALCULATION FUNCTION ==========
function calculateAll() {
    // Validate input
    const gajiPokok = parseRupiah(document.getElementById('gaji-pokok').value);
    if (gajiPokok < 1000000) {
        alert('Masukkan gaji pokok minimal Rp 1.000.000');
        return;
    }
    
    // Show loading
    const calculateBtn = document.getElementById('calculate-btn');
    const originalText = calculateBtn.innerHTML;
    calculateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Menghitung...';
    calculateBtn.disabled = true;
    
    setTimeout(() => {
        // Calculate
        const results = calculateFinancials();
        if (!results) {
            calculateBtn.innerHTML = originalText;
            calculateBtn.disabled = false;
            return;
        }
        
        // Save for line chart updates
        window.lastCalculation = {
            monthlySave: results.monthlySavings,
            aman: results.safeFund,
            displayPeriod: currentPeriod
        };
        
        // Update UI
        updateUI(results);
        
        // Create charts
        createCharts(results);
        
        // Dream planner result
        const dreamResult = calculateDreamPlan(results);
        document.getElementById('dream-result').innerHTML = dreamResult;
        
        // Switch views
        document.getElementById('initial-message').classList.add('hidden');
        document.getElementById('detailed-results').classList.remove('hidden');
        document.getElementById('edit-btn').classList.remove('hidden');
        
        // Scroll to results on mobile
        if (window.innerWidth < 768) {
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Restore button
        calculateBtn.innerHTML = originalText;
        calculateBtn.disabled = false;
        
    }, 1000);
}

// ========== EVENT LISTENERS ==========
document.getElementById('calculate-btn').addEventListener('click', calculateAll);

document.getElementById('edit-btn').addEventListener('click', function() {
    document.getElementById('detailed-results').classList.add('hidden');
    document.getElementById('initial-message').classList.remove('hidden');
    this.classList.add('hidden');
    document.getElementById('input-section').scrollIntoView({ behavior: 'smooth' });
});

document.getElementById('back-btn').addEventListener('click', function() {
    document.getElementById('detailed-results').classList.add('hidden');
    document.getElementById('initial-message').classList.remove('hidden');
    document.getElementById('input-section').scrollIntoView({ behavior: 'smooth' });
});

// ========== SCROLL TO TOP ==========
const scrollTopBtn = document.getElementById('scroll-top');

window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
        scrollTopBtn.classList.add('visible');
    } else {
        scrollTopBtn.classList.remove('visible');
    }
});

scrollTopBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
});

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', async function() {
    // Load gold price
    await updateGoldPrice();
    
    // Start auto-update every 2 minutes
    goldUpdateInterval = setInterval(updateGoldPrice, 2 * 60 * 1000);
    
    // Load saved settings
    const savedPeriod = localStorage.getItem('selected_period');
    if (savedPeriod) {
        currentPeriod = parseInt(savedPeriod);
        document.querySelectorAll('.period-btn').forEach(btn => {
            if (parseInt(btn.dataset.period) === currentPeriod) {
                btn.classList.add('active');
                document.getElementById('line-chart-period').textContent = currentPeriod + ' Bulan';
            }
        });
    }
    
    const savedInflation = localStorage.getItem('inflation_toggle');
    if (savedInflation !== null) {
        document.getElementById('inflation-toggle').checked = savedInflation === 'true';
        document.getElementById('inflation-toggle').dispatchEvent(new Event('change'));
    }
    
    const savedKewajiban = localStorage.getItem('kewajiban_amount');
    if (savedKewajiban) {
        document.getElementById('kewajiban-bulanan').value = parseInt(savedKewajiban).toLocaleString('id-ID');
    }
});
</script>
</body>
</html>
