<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kalkulator Keamanan Nikah & Kelahiran</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {font-family: Arial; background:#f3f4f6; margin:0; padding:20px;}
.app {max-width:960px; margin:auto; display:grid; grid-template-columns:1fr 1fr; gap:20px;}
.card {background:#fff; padding:24px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.06);}
h2 {margin-top:0;}
label {font-weight:bold; display:block; margin-top:15px;}
input,select,button {width:100%; padding:14px; margin-top:8px; font-size:16px; border-radius:10px; border:1px solid #ddd;}
button {background:#f5c400; border:none; font-weight:bold; cursor:pointer;}
.big {font-size:28px; font-weight:bold; margin:10px 0;}
.note {font-size:13px; background:#fff3cd; padding:12px; border-radius:10px; margin-top:12px;}
.cta {background:#0f9d58; color:white; font-size:18px; margin-top:15px;}
.loading {display:none; margin-top:10px; font-size:14px; color:#555;}
</style>
</head>

<body>

<div class="app">

<div class="card">
<h2>Kalkulator Keamanan</h2>

<label>Status hidup</label>
<select id="status">
  <option value="nikah">Akan Menikah</option>
  <option value="hamil">Hamil</option>
  <option value="anak">Sudah Punya Anak</option>
</select>

<label>Penghasilan per bulan</label>
<input id="income" type="text" placeholder="contoh: 3.000.000">

<button onclick="hitung()">Hitung Keamanan</button>
<div class="loading" id="loading">Mengambil harga emas hari ini…</div>
</div>

<div class="card">
<div class="big" id="emas">–</div>
<canvas id="chart"></canvas>
<div id="detail"></div>

<button class="cta" id="waBtn" style="display:none;">Kunci Dana Nikah Saya di Emas</button>

<div class="note">
Ini bukan dana darurat. Ini dana tujuan (nikah, lahiran, anak). Dana darurat tetap harus kamu punya terpisah.
</div>
</div>

</div>

<script>
let chart;

// format rupiah
function formatIDR(x){
  return x.toLocaleString("id-ID");
}

// input titik ribuan
document.getElementById("income").addEventListener("input", function(e){
  let val = e.target.value.replace(/\D/g,"");
  e.target.value = val ? parseInt(val).toLocaleString("id-ID") : "";
});

// harga emas realtime Antam
async function getHargaEmas(){
  try{
    const res = await fetch("https://logam-mulia-api.vercel.app/api/antam");
    const data = await res.json();
    return data.price;
  }catch(e){
    console.error("API emas gagal, pakai fallback", e);
    return 2652000; // fallback aman
  }
}

async function hitung(){
  const raw = document.getElementById("income").value.replace(/\./g,"");
  const income = Number(raw);
  const status = document.getElementById("status").value;
  if(!income || income<=0) return;

  document.getElementById("loading").style.display="block";

  const mult = {nikah:6, hamil:4, anak:3};
  const statusText = {nikah:"menikah", hamil:"kehamilan & persalinan", anak:"membesarkan anak"};

  const target = income * mult[status];
  const buffer = income * 0.7 * 3;
  let aman = target - buffer;
  if(aman < 0) aman = 0;

  const harga = await getHargaEmas();
  const gram = aman / harga;

  const cicil6 = aman / 6;
  const cicil12 = aman / 12;

  document.getElementById("emas").innerText = gram.toFixed(2)+" gram emas";

  document.getElementById("detail").innerHTML = `
<b>Dana besar yang kamu butuhkan untuk fase ini</b><br>
Rp ${formatIDR(target)}<br>
<i>(estimasi realistis untuk ${statusText[status]})</i><br><br>

<b>Dana penyangga hidup (3 bulan)</b><br>
Rp ${formatIDR(buffer)}<br>
<i>(uang yang harus tetap ada di rekening)</i><br><br>

<b>Dana yang sudah aman dikunci</b><br>
Rp ${formatIDR(aman)}<br>
<i>(bagian yang bisa langsung diamankan tanpa mengganggu hidup)</i><br><br>

<b>Setara emas:</b> ${gram.toFixed(2)} gram<br>
<b>Harga emas hari ini:</b> Rp ${formatIDR(harga)} / gram<br><br>

<b>Jika dana ini dikumpulkan bertahap (bukan cicilan hutang):</b><br>
• 6 bulan → Rp ${formatIDR(cicil6)} / bulan<br>
<i>(supaya dalam 6 bulan terkumpul Rp ${formatIDR(aman)})</i><br>
• 12 bulan → Rp ${formatIDR(cicil12)} / bulan<br>
<i>(supaya dalam 12 bulan terkumpul Rp ${formatIDR(aman)})</i>
`;

  const data = [aman, target-aman];
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("chart"),{
    type:"doughnut",
    data:{labels:["Aman","Berisiko"], datasets:[{data}]}
  });

  const waText = encodeURIComponent(
`Halo, saya mau mengamankan dana ${statusText[status]} saya.

Hasil kalkulator:
• Target dana: Rp ${formatIDR(target)}
• Dana penyangga (tidak boleh disentuh): Rp ${formatIDR(buffer)}
• Dana yang siap dikunci: Rp ${formatIDR(aman)}
• Setara: ${gram.toFixed(2)} gram emas

Saya ingin dibantu skema pengunciannya.`
  );

  document.getElementById("waBtn").style.display="block";
  document.getElementById("waBtn").onclick=function(){
    window.open("https://wa.me/6285123882845?text="+waText,"_blank");
  };

  document.getElementById("loading").style.display="none";
}
</script>

</body>
</html>
