<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Keamanan â€“ HONORER DIGITAL</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Font Premium: Plus Jakarta Sans -->
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* ===== VARS (DESIGN TOKENS) ===== */
:root {
  --primary: #fbbf24;      /* Kuning Emas - Tombol & Aksen */
  --primary-dark: #d97706; /* Amber Gelap - Hover */
  --success: #10b981;      /* Hijau - Aman */
  --success-dark: #047857; /* Hijau Gelap - Teks Aman */
  
  /* Neutrals */
  --bg-body: #f1f5f9; /* Latar Belakang Utama (Abu-abu muda kebiruan) */
  --bg-card: #ffffff;
  --text-main: #1e293b;
  --text-muted: #64748b;
  --border: #e2e8f0;
  
  /* Spacing & Radius */
  --radius: 20px;
  --radius-sm: 12px;
  --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
}

/* ===== RESET ===== */
*{ box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body{
  font-family: 'Plus Jakarta Sans', sans-serif;
  background: var(--bg-body);
  /* Background pola grid halus agar modern tapi tetap ringan */
  background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
  background-size: 24px 24px;
  margin:0;
  padding:40px 20px;
  color:var(--text-main);
  min-height: 100vh;
}

/* ===== HEADER ===== */
.header-wrapper {
  text-align: center;
  margin-bottom: 40px;
  animation: fadeIn 0.8s ease-out;
}
.header-wrapper h1 {
  font-size: 34px;
  font-weight: 800;
  color: var(--text-main);
  margin: 0;
  text-transform: uppercase;
  letter-spacing: -1px;
}
.header-wrapper span { color: var(--primary-dark); }

/* ===== LAYOUT ===== */
.app{
  max-width:980px;
  margin:0 auto;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:32px;
}

/* ===== CARDS ===== */
.card{
  background: var(--bg-card);
  padding: 36px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-soft);
  border: 1px solid rgba(255,255,255,0.8);
  position: relative;
  overflow: hidden;
}
/* Animasi halus saat kartu muncul */
.card { animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; transform: translateY(20px); }
.card:nth-child(2) { animation-delay: 0.1s; }

/* ===== TYPOGRAPHY ===== */
h2 {
  margin-top:0; margin-bottom:32px; 
  font-size: 20px; 
  color: var(--text-main); 
  font-weight: 700; 
  display: flex; 
  justify-content: space-between; 
  align-items: center;
}

label {
  font-size: 13px;
  font-weight: 700;
  color: var(--text-muted);
  margin-bottom: 8px;
  display: block;
  margin-top: 24px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ===== FORM ELEMENTS ===== */
input, select {
  width:100%;
  padding: 18px;
  font-size: 16px;
  font-family: inherit;
  color: var(--text-main);
  background: #f8fafc;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  outline: none;
  font-weight: 500;
}
input:focus, select:focus {
  background: #fff;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.2);
  transform: translateY(-2px);
}

/* ===== BUTTONS ===== */
button {
  width: 100%;
  padding: 18px;
  margin-top: 40px;
  font-size: 16px;
  font-weight: 700;
  border-radius: var(--radius-sm);
  border: none;
  cursor: pointer;
  font-family: inherit;
  letter-spacing: 0.5px;
  transition: all 0.2s ease;
}

#btn-calc {
  background: linear-gradient(135deg, var(--primary) 0%, #f59e0b 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
  position: relative;
  overflow: hidden;
}
#btn-calc:hover { 
  transform: translateY(-3px); 
  box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4); 
}
#btn-calc:active { transform: translateY(-1px); }
#btn-calc:disabled { 
  background: #cbd5e1; 
  color: #94a3b8;
  cursor: not-allowed; 
  transform: none; 
  box-shadow: none; 
}

/* Loading Spinner */
.spinner {
  width: 20px; height: 20px; 
  border: 3px solid rgba(255,255,255,0.3); 
  border-radius: 50%; 
  border-top-color: #fff;
  animation: spin 0.8s linear infinite; 
  display: none; 
  margin-right: 10px; 
  vertical-align: middle;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* CTA Buttons (Bottom) */
.cta-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-top: 24px;
}
.cta { 
  background: var(--text-main); 
  color: #fff; 
  padding: 14px;
  margin-top: 0;
  font-size: 14px;
  border-radius: 12px;
  text-align: center;
}
.cta:hover { background: black; }
.cta.wa {
  background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
}
.cta.save {
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
}

/* ===== RESULT AREA ===== */
.result-wrapper {
  text-align: center;
  margin-bottom: 35px;
  padding-bottom: 35px;
  border-bottom: 1px solid var(--border);
  animation: fadeIn 1s ease-out;
}

.big-label { 
  font-size: 11px; 
  text-transform: uppercase; 
  letter-spacing: 1.5px; 
  color: var(--text-muted); 
  font-weight: 800; 
  margin-bottom: 12px;
}
.big-value {
  font-size: 42px; 
  font-weight: 800; 
  color: var(--success-dark); 
  margin: 0; 
  line-height: 1.1;
}
.sub-value {
  font-size: 13px; color: var(--text-muted); margin-top: 8px; font-weight: 500;
}

#chart-container { 
  position: relative; 
  height: 220px; 
  width: 100%; 
  margin-bottom: 30px; 
  animation: fadeIn 1.2s ease-out;
}

#detail {
  font-size: 14px; 
  line-height: 1.6;
  color: var(--text-main); 
  display:none;
}

/* Detail Boxes */
.section-box {
  background: #f8fafc;
  padding: 24px;
  border-radius: 16px;
  margin-bottom: 20px;
  border: 1px solid var(--border);
  /* Staggered Animation via JS class toggle */
  opacity: 0; 
  animation: slideUpFade 0.6s ease forwards;
}

.section-title {
  font-weight: 700; font-size: 15px; margin-bottom: 6px; color: var(--text-main);
  display: flex; justify-content: space-between; align-items: center;
}
.section-tag {
  font-size: 10px; padding: 4px 10px; border-radius: 20px; font-weight: 800; text-transform: uppercase;
  letter-spacing: 0.5px;
}
.tag-yellow { background: #fffbeb; color: #b45309; border: 1px solid #fcd34d; }
.tag-green { background: #ecfdf5; color: #047857; border: 1px solid #a7f3d0; }

.section-price {
  font-size: 24px; font-weight: 800; color: var(--text-main); margin: 8px 0 12px 0; letter-spacing: -0.5px;
}
.section-desc {
  font-size: 13px; color: var(--text-muted); margin-bottom: 0; line-height: 1.6;
}

/* Plan Box (The one user liked) */
.plan-box {
  background: #ffffff; 
  border-radius: 12px; 
  padding: 20px; 
  margin-top: 16px;
  border: 1px solid #e2e8f0;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
}
.plan-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px; color: #475569; }
.plan-row.highlight { font-size: 17px; font-weight: 800; color: var(--success-dark); border-top: 1px dashed #cbd5e1; padding-top: 12px; margin-top: 10px; margin-bottom: 0; }

.footnote {
  font-size: 11px; color: #64748b; margin-top: 12px; line-height: 1.5; font-style: italic;
}

/* API STATUS & ANIMATION */
.api-status {
  font-size: 10px; padding: 4px 10px; border-radius: 20px; background: #f1f5f9; color: #64748b;
  font-weight: 700; text-transform: uppercase; transition: all 0.3s;
}
.api-status.status-online {
  background: #d1fae5; color: #047857;
  animation: pulse-green 2s infinite;
}
@keyframes pulse-green {
  0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
  70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); }
  100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
}

/* ===== ANIMATIONS ===== */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideUp { 
  from { opacity: 0; transform: translateY(20px); } 
  to { opacity: 1; transform: translateY(0); } 
}
@keyframes slideUpFade {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== MOBILE ===== */
@media(max-width:768px){
  .app{grid-template-columns:1fr;}
  .header-wrapper h1{ font-size: 28px; }
  .big-value { font-size: 36px; }
  .card { padding: 28px 24px; }
  .section-price { font-size: 22px; }
  .cta-group { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header-wrapper">
  <h1>HONORER <span>DIGITAL</span></h1>
</div>

<div class="app">

<!-- LEFT CARD: INPUT -->
<div class="card">
<h2>
  <span>Rencana Keuangan</span>
  <span class="api-status" id="apiStatus">Checking...</span>
</h2>

<label>Status saat ini</label>
<select id="status">
  <option value="nikah">Akan Menikah</option>
  <option value="hamil">Hamil / Persalinan</option>
  <option value="anak">Sudah Punya Anak</option>
</select>

<label>Penghasilan bulanan</label>
<div class="input-group">
  <input id="income" type="text" placeholder="Contoh: 3.000.000" autocomplete="off">
</div>

<label>Target Tercapai Tanggal (Opsional)</label>
<div class="input-group">
  <input id="targetDate" type="date">
  <div style="font-size:12px; color:#94a3b8; margin-top:8px; line-height:1.4;">Contoh: Tanggal rencana nikah / HPL</div>
</div>

<button id="btn-calc" onclick="hitung()">
  <span class="spinner" id="btn-spinner"></span>
  <span id="btn-text">Hitung Keamanan</span>
</button>
</div>

<!-- RIGHT CARD: RESULT -->
<div class="card">
<h2>Hasil Analisis</h2>

<div class="result-wrapper">
  <div class="big-label">Total Aset Aman Tercatat</div>
  <div class="big-value" id="emas">0 gram</div>
  <div class="sub-value">Dana yang bisa dikunci ke emas</div>
</div>

<div id="chart-container">
  <canvas id="chart"></canvas>
</div>

<!-- Detail Content -->
<div id="detail"></div>

<!-- CTA Buttons -->
<div class="cta-group" id="btn-container" style="display:none;">
  <button class="cta wa" id="waBtn">ðŸ”’ Kunci Dana di Emas</button>
  <button class="cta save" id="shareBtn">ðŸ’¾ Simpan Analisa</button>
</div>

<div style="font-size: 12px; color: #94a3b8; text-align: center; margin-top: 25px; line-height: 1.5;">
  Data harga emas diupdate realtime (Logam Mulia)<br>
  <strong>Catatan:</strong> Ini adalah dana tujuan, bukan dana darurat.
</div>
</div>

</div>

<script>
let chart;
let animationFrameId; 

function formatIDR(x){return x.toLocaleString("id-ID");}

// Input Formatter
document.getElementById("income").addEventListener("input",e=>{
  let v=e.target.value.replace(/[^0-9]/g,"");
  e.target.value=v?parseInt(v).toLocaleString("id-ID"):"";
});

// Animation Logic (Optimized)
function animateValue(obj, start, end, duration) {
  if (animationFrameId) cancelAnimationFrame(animationFrameId);
  let startTimestamp = null;
  const step = (timestamp) => {
    if (!startTimestamp) startTimestamp = timestamp;
    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
    obj.innerHTML = (progress * (end - start) + start).toFixed(2) + " gram";
    if (progress < 1) {
      animationFrameId = window.requestAnimationFrame(step);
    }
  };
  animationFrameId = window.requestAnimationFrame(step);
}

/* ===== SYSTEM LOGIC ===== */
function getCachedHarga(){
  const c=localStorage.getItem("harga_emas_cache");
  if(!c) return null;
  const o=JSON.parse(c);
  if(Date.now()-o.time>15*60*1000) return null;
  return o.price;
}
function setCachedHarga(p){
  localStorage.setItem("harga_emas_cache",JSON.stringify({time:Date.now(),price:p}));
}
async function getHargaEmas(){
  const cached=getCachedHarga();
  // Tampilkan status UI
  const badge = document.getElementById("apiStatus");
  
  if(cached) {
    badge.innerText = "LIVE"; 
    badge.classList.add("status-online");
    return cached;
  }
  
  badge.innerText = "Updating...";
  try{
    const r=await fetch("https://logam-mulia-api.vercel.app/api/antam");
    const d=await r.json();
    setCachedHarga(d.buy);
    // Jika sukses: Berkedip Hijau
    badge.innerText = "LIVE";
    badge.classList.add("status-online");
    return d.buy;
  }catch(err){
    console.log("API Error:", err);
    // Jika gagal: Offline
    badge.innerText = "OFFLINE";
    badge.classList.remove("status-online");
    return getCachedHarga()||2652000; 
  }
}

window.onload=async ()=>{
  await getHargaEmas();
};

async function hitung(){
  const incomeStr = document.getElementById("income").value;
  const income=Number(incomeStr.replace(/[^0-9]/g,""));
  const status=document.getElementById("status").value;
  const targetDateInput = document.getElementById("targetDate").value;
  
  if(!income || income === 0) {
    alert("Mohon isi penghasilan dengan benar.");
    document.getElementById("income").focus();
    return;
  }

  // Loading State
  const btn = document.getElementById("btn-calc");
  const btnText = document.getElementById("btn-text");
  const btnSpinner = document.getElementById("btn-spinner");
  btn.disabled = true;
  btnText.innerText = "Menganalisis...";
  btnSpinner.style.display = "inline-block";

  const mult={nikah:6,hamil:4,anak:3};
  const reason={
    nikah:["Biaya KUA & Legalitas Dokumen","Mahar/Seserahan","Biaya Akad & Pesta Sederhana","Pindahan & Uang Muka Tempat Tinggal","Perlengkapan Rumah Tangga","Biaya Hidup Bulan Pertama","Dana Cadangan Tak Terduga"],
    hamil:["Biaya Kontrol Rutin & USG","Suplemen & Nutrisi Ibu","Biaya Persalinan & RS","Biaya Dokter Spesialis","Perlengkapan Bayi Baru","Biaya Perawatan Pasca Melahirkan","Dana Darurat Komplikasi"],
    anak:["Biaya Rutin Susu & Makanan","Imunisasi & Kesehatan","Perlengkapan Anak","Biaya Pendidikan Awal","Transportasi & Aktivitas","Biaya Hidup Tambahan","Dana Sakit Anak"]
  };

  const target=income*mult[status]; 
  const buffer=income*0.7*3; 
  const aman=Math.max(0,target-buffer); 

  const harga=await getHargaEmas();
  const gram=aman/harga;

  animateValue(document.getElementById("emas"), 0, gram, 1000);

  const list=reason[status].map(x=>"<li>"+x+"</li>").join("");

  // Logic Tanggal
  let targetPlanHTML = "";
  if (targetDateInput) {
    const targetDate = new Date(targetDateInput);
    const now = new Date();
    const diffTime = targetDate - now;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
    const diffMonths = Math.ceil(diffDays / 30);

    if (diffMonths <= 0) {
       targetPlanHTML = `<div class="plan-box" style="background:#fee2e2; border-color:#fca5a5;">
         <div style="color:#b91c1c; font-weight:bold;">Waktu Terlampaui</div>
         <div style="font-size:12px; color:#991b1b;">Tanggal target sudah lewat.</div>
       </div>`;
    } else {
       const tabunganPerBulan = Math.ceil(aman / diffMonths);
       
       targetPlanHTML = `
       <div class="plan-box">
         <div class="plan-row"><span>Target Tanggal:</span> <strong>${targetDate.toLocaleDateString('id-ID')}</strong></div>
         <div class="plan-row"><span>Sisa Waktu:</span> <strong>${diffMonths} Bulan</strong></div>
         <div class="plan-row highlight">
           <span>Tabungan Emas:</span> <span>Rp ${formatIDR(tabunganPerBulan)} / bln</span>
         </div>
         <div class="footnote">
           *Angka ini hanya untuk penguncian emas (Dana Aman). Sisanya (${formatIDR(buffer)}) adalah dana tunai yang dianggap tercicil dari gaji bulanan.
         </div>
       </div>`;
    }
  } else {
    const cicil6=aman/6;
    const cicil12=aman/12;
    targetPlanHTML = `
    <div class="plan-box" style="background:#f8fafc; border-color:#e2e8f0;">
      <div style="font-size:12px; color:#64748b; margin-bottom:8px; font-weight:600;">Simulasi Tabungan Emas (Umum)</div>
      <div class="plan-row"><span>6 Bulan:</span> <strong>Rp ${formatIDR(Math.ceil(cicil6))} / bln</strong></div>
      <div class="plan-row"><span>12 Bulan:</span> <strong>Rp ${formatIDR(Math.ceil(cicil12))} / bln</strong></div>
    </div>`;
  }

  document.getElementById("detail").style.display = "block";
  
  // HTML Layout (Disesuaikan permintaan user)
  document.getElementById("detail").innerHTML=`
<div class="section-box" style="animation-delay: 0.1s;">
  <div class="section-title">
    Kebutuhan Dana Besar
    <span class="section-tag tag-yellow">Yang Wajib Dianggarkan</span>
  </div>
  <div class="section-price">Rp ${formatIDR(target)}</div>
  <div class="section-desc">
    Total biaya yang dibutuhkan saat kejadian tersebut terjadi. 
    <ul style="margin: 10px 0 0 0; padding-left: 16px; color: var(--text-muted); font-size: 13px;">${list}</ul>
  </div>
</div>

<div class="section-box" style="animation-delay: 0.2s;">
  <div class="section-title">
    Dana Penyangga Hidup
    <span class="section-tag tag-yellow">Wajib Tunai</span>
  </div>
  <div class="section-price" style="color:var(--primary-dark);">Rp ${formatIDR(buffer)}</div>
  <div class="section-desc">
    Uang tunai yang wajib ada di rekening. Gunanya sebagai sabuk pengaman jika penghasilan berhenti, agar kebutuhan dasar tetap aman.
  </div>
</div>

<div class="section-box" style="animation-delay: 0.3s; background: #fff; border: 1px solid #d1fae5;">
  <div class="section-title">
    Dana Siap Dikunci
    <span class="section-tag tag-green">Bisa di Emas</span>
  </div>
  <div class="section-price" style="color:var(--success-dark);">Rp ${formatIDR(aman)}</div>
  <div class="section-desc">
    Ini adalah sisa dana dari total kebutuhan yang aman untuk dikunci (diinvestasikan) dalam bentuk emas.
    <br><br>
    <strong>Setara emas:</strong> ${gram.toFixed(2)} gram<br>
    <strong>Harga emas:</strong> Rp ${formatIDR(harga)} / gram
  </div>
  ${targetPlanHTML}
</div>
`;

  // Chart Logic (Warna Hijau & Kuning Screenshot)
  const data=[aman,buffer];
  if(chart) chart.destroy();
  
  const ctx = document.getElementById('chart').getContext('2d');
  chart=new Chart(ctx,{
    type:"doughnut",
    data:{
      labels:["Aman","Penyangga"],
      datasets:[{
        data:data,
        backgroundColor: ["#10b981", "#fbbf24"], // HIJAU & KUNING
        borderWidth:0,
        hoverOffset: 6
      }]
    },
    options: {
      cutout: '78%',
      responsive: true,
      maintainAspectRatio: false,
      plugins: { 
        legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8, font: {size: 12, family: 'Plus Jakarta Sans'} } } 
      },
      animation: {
        animateScale: true,
        animateRotate: true,
        duration: 1500,
        easing: 'easeOutQuart'
      }
    }
  });

  localStorage.setItem("honorer_kalkulasi",JSON.stringify({status,income,targetDate:targetDateInput,target,buffer,aman,gram,harga}));

  // Show Buttons
  document.getElementById("btn-container").style.display = "grid";

  // PREPARE DETAILED WA MESSAGES
  const fullWaText = encodeURIComponent(
`HONORER DIGITAL - PERENCANAAN KEAMANAN

DATA PERENCANAAN:
Status: ${status.charAt(0).toUpperCase() + status.slice(1)}
Penghasilan: Rp ${formatIDR(income)}

1. KEBUTUHAN DANA BESAR: Rp ${formatIDR(target)}
   (Sekali bayar saat kejadian)

2. DANA PENYANGGA: Rp ${formatIDR(buffer)}
   (Wajib Tunai - Safety Buffer)

3. DANA AMAN (BUAT EMAS): Rp ${formatIDR(aman)}
   Setara Emas: ${gram.toFixed(2)} gram
   Harga Emas: Rp ${formatIDR(harga)}/gr

RENCANA TABUNGAN:
- Target Tanggal: ${targetDateInput ? new Date(targetDateInput).toLocaleDateString('id-ID') : '-'}
- Tabungan Emas: Rp ${targetDateInput ? formatIDR(Math.ceil(aman/Math.ceil((new Date(targetDateInput)-new Date())/(1000*60*60*24*30)))) : '-'} / bln

Mohon bantu penguncian.`
  );

  // Tombol WA Admin
  document.getElementById("waBtn").onclick=()=>window.open("https://wa.me/6285123882845?text="+fullWaText);
  
  // Tombol Simpan/Send ke Sendiri
  document.getElementById("shareBtn").onclick=()=>window.open("https://wa.me/?text="+encodeURIComponent("Simpan Analisa Keuangan Saya:\n\n"+fullWaText));

  // Reset Button
  btn.disabled = false;
  btnText.innerText = "Hitung Keamanan";
  btnSpinner.style.display = "none";
}
</script>
</body>
</html>
