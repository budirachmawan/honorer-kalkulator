<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kalkulator Keamanan Nikah</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:Arial;
  background:#f3f4f6;
  margin:0;
  padding:12px;
}

/* ===== BRAND HEADER ===== */
.header{
  position:relative;
  margin-bottom:16px;
}
.banner{
  width:100%;
  border-radius:14px;
}
.logo{
  position:absolute;
  top:10px;
  left:10px;
  width:64px;
  background:#fff;
  padding:6px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}

/* ===== LAYOUT ===== */
.app{
  max-width:980px;
  margin:auto;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
}
.card{
  background:#fff;
  padding:22px;
  border-radius:16px;
  box-shadow:0 6px 20px rgba(0,0,0,.06);
}
h2{margin-top:0;}
label{font-weight:bold;display:block;margin-top:14px;}
input,select,button{
  width:100%;
  padding:14px;
  margin-top:8px;
  font-size:16px;
  border-radius:10px;
  border:1px solid #ddd;
}
button{
  background:#f5c400;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
.big{
  font-size:32px;
  font-weight:bold;
  margin:10px 0;
  text-align:center;
}
.cta{
  background:#0f9d58;
  color:white;
  font-size:18px;
  margin-top:18px;
  padding:14px;
}
.note{
  font-size:13px;
  background:#fff3cd;
  padding:12px;
  border-radius:10px;
  margin-top:14px;
}
.loading{display:none;margin-top:10px;font-size:14px;color:#555;}
.small{font-size:12px;color:#777;margin-top:10px;text-align:center;}

/* ===== MOBILE ===== */
@media(max-width:768px){
  .app{grid-template-columns:1fr;}
  .big{font-size:26px;}
  .logo{width:48px;}
}
</style>
</head>

<body>

<!-- ===== BRANDING ===== -->
<div class="header">
  <img src="banner.png" class="banner">
  <img src="logo.png" class="logo">
</div>

<div class="app">

<div class="card">
<h2>Kalkulator Keamanan</h2>

<label>Status hidup</label>
<select id="status">
  <option value="nikah">Akan Menikah</option>
  <option value="hamil">Hamil</option>
  <option value="anak">Sudah Punya Anak</option>
</select>

<label>Penghasilan per bulan</label>
<input id="income" type="text" placeholder="contoh: 3.000.000">

<button onclick="hitung()">Hitung Keamanan</button>
<div class="loading" id="loading">Mengambil harga emas hari ini…</div>
</div>

<div class="card">
<div class="big" id="emas">–</div>
<canvas id="chart"></canvas>
<div id="detail" style="margin-top:18px"></div>

<button class="cta" id="waBtn" style="display:none;">Kunci Dana Nikah Saya di Emas</button>

<div class="small">
Harga emas diambil dari sumber resmi dan diupdate realtime
</div>

<div class="note">
Ini bukan dana darurat. Ini dana tujuan (nikah, lahiran, anak). Dana darurat tetap harus kamu punya terpisah.
</div>
</div>

</div>

<script>
let chart;

/* ===== FORMAT INPUT ===== */
document.getElementById("income").addEventListener("input",e=>{
  let v=e.target.value.replace(/\D/g,"");
  e.target.value=v?parseInt(v).toLocaleString("id-ID"):"";
});
function formatIDR(x){return x.toLocaleString("id-ID");}

/* ===== CACHE HARGA ===== */
function getCachedHarga(){
  const c=localStorage.getItem("harga_emas_cache");
  if(!c) return null;
  const o=JSON.parse(c);
  if(Date.now()-o.time>15*60*1000) return null;
  return o.price;
}
function setCachedHarga(p){
  localStorage.setItem("harga_emas_cache",JSON.stringify({time:Date.now(),price:p}));
}

/* ===== API ===== */
async function getHargaEmas(){
  const cached=getCachedHarga();
  if(cached) return cached;
  try{
    const r=await fetch("https://logam-mulia-api.vercel.app/api/antam");
    const d=await r.json();
    setCachedHarga(d.buy);
    return d.buy;
  }catch{
    return getCachedHarga()||2652000;
  }
}

/* ===== HITUNG ===== */
async function hitung(){
  const income=Number(document.getElementById("income").value.replace(/\./g,""));
  if(!income) return;
  document.getElementById("loading").style.display="block";

  const status=document.getElementById("status").value;
  const mult={nikah:6,hamil:4,anak:3};
  const text={nikah:"menikah",hamil:"kehamilan",anak:"anak"};

  const target=income*mult[status];
  const buffer=income*0.7*3;
  let aman=target-buffer;
  if(aman<0) aman=0;

  const harga=await getHargaEmas();
  const gram=aman/harga;

  document.getElementById("emas").innerText=gram.toFixed(2)+" gram emas";

  document.getElementById("detail").innerHTML=`
<b>Dana besar yang kamu butuhkan</b><br>Rp ${formatIDR(target)}<br><br>
<b>Dana penyangga 3 bulan</b><br>Rp ${formatIDR(buffer)}<br><br>
<b>Dana aman dikunci</b><br>Rp ${formatIDR(aman)}<br><br>
<b>Setara emas:</b> ${gram.toFixed(2)} gram<br>
<b>Harga emas:</b> Rp ${formatIDR(harga)} / gram
`;

  const data=[aman,target-aman];
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"doughnut",
    data:{labels:["Aman","Berisiko"],datasets:[{data}]}
  });

  const waText=encodeURIComponent(
`Saya mau mengamankan dana ${text[status]} saya.
Dana siap dikunci: Rp ${formatIDR(aman)}
Setara: ${gram.toFixed(2)} gram emas`
  );

  document.getElementById("waBtn").style.display="block";
  document.getElementById("waBtn").onclick=()=>window.open("https://wa.me/6285123882845?text="+waText);

  document.getElementById("loading").style.display="none";
}
</script>
</body>
</html>
