<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HONORER DIGITAL - Financial Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===== DESIGN SYSTEM & VARIABLES ===== */
:root {
  /* Palette Warna */
  --primary: #fbbf24;
  --primary-dark: #b45309;
  --primary-gradient: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
  --success: #10b981;
  --success-bg: #ecfdf5;
  --success-dark: #064e3b;
  --danger: #ef4444;
  --danger-bg: #fef2f2;
  --info: #3b82f6;
  --info-bg: #eff6ff;
  --warning: #f59e0b;
  
  /* Backgrounds & Text */
  --bg-body: #f8fafc;
  --bg-card: #ffffff;
  --text-main: #0f172a;
  --text-muted: #64748b;
  --text-light: #94a3b8;
  --border: #e2e8f0;
  
  /* Shapes */
  --radius-xl: 24px;
  --radius-lg: 16px;
  --shadow-soft: 0 10px 30px -10px rgba(0, 0, 0, 0.05);
  --shadow-float: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

body {
  font-family: 'Plus Jakarta Sans', sans-serif;
  background-color: var(--bg-body);
  color: var(--text-main);
  margin: 0;
  padding: 20px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.app-container {
  max-width: 900px;
  width: 100%;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1fr;
  gap: 24px;
}

/* Desktop Grid */
@media (min-width: 768px) {
  .app-container { grid-template-columns: 400px 1fr; align-items: start; }
}

/* ===== HEADER & NAV ===== */
header { text-align: center; margin-bottom: 20px; animation: fadeInDown 0.6s ease-out; }
.brand-title { font-size: 28px; font-weight: 800; letter-spacing: -0.05em; color: var(--text-main); margin: 0; }
.brand-gold { background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

.api-badge {
  display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px;
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 50px;
  font-size: 11px; font-weight: 700; color: var(--text-muted); margin-top: 12px; box-shadow: var(--shadow-soft);
}
.status-dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--text-light); transition: background 0.3s; }
.status-dot.online { background-color: var(--success); box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2); }

/* ===== CARDS ===== */
.card {
  background: var(--bg-card); border-radius: var(--radius-xl); padding: 28px;
  box-shadow: var(--shadow-soft); border: 1px solid rgba(255,255,255,0.8);
  position: relative; overflow: hidden;
}
.slide-up { animation: slideUp 0.7s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; transform: translateY(20px); }

/* ===== INPUTS ===== */
.form-group { margin-bottom: 24px; position: relative; }
.form-label { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 8px; display: block; }
.input-wrapper { position: relative; }
input, select {
  width: 100%; padding: 12px 4px; font-size: 16px; font-family: inherit;
  color: var(--text-main); background: transparent; border: none;
  border-bottom: 2px solid var(--border); border-radius: 0;
  transition: all 0.3s ease;
}
input:focus, select:focus { border-bottom-color: var(--primary); background: linear-gradient(to top, rgba(251, 191, 36, 0.05), transparent); }
select { appearance: none; cursor: pointer; }
.select-arrow { position: absolute; right: 0; top: 12px; pointer-events: none; color: var(--primary); font-size: 12px; }
.input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

/* DREAM CARD DARK THEME */
.dream-card {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white;
  padding: 24px; border-radius: var(--radius-lg); margin-bottom: 24px;
  box-shadow: var(--shadow-float); border: 1px solid #334155;
}
.dream-card label { color: #94a3b8; }
.dream-card input, .dream-card select {
  background: rgba(255,255,255,0.05); border-bottom-color: rgba(255,255,255,0.2); color: white;
}
.dream-card input:focus, .dream-card select:focus {
  background: rgba(255,255,255,0.1); border-bottom-color: var(--primary);
}
.dream-title { font-weight: 700; color: var(--primary); font-size: 14px; margin-bottom: 16px; display: block; }

/* ===== BUTTONS ===== */
.btn-main {
  width: 100%; padding: 18px; border: none; border-radius: var(--radius-lg);
  background: var(--primary-gradient); color: white; font-size: 16px; font-weight: 800;
  font-family: inherit; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 10px 20px -5px rgba(217, 119, 6, 0.4);
  display: flex; justify-content: center; align-items: center;
}
.btn-main:hover { transform: translateY(-2px); box-shadow: 0 15px 25px -5px rgba(217, 119, 6, 0.5); }
.btn-secondary {
  width: 100%; padding: 14px; background: white; color: var(--text-muted);
  border: 2px solid var(--border); border-radius: var(--radius-lg); font-weight: 700;
  cursor: pointer; margin-top: 12px; transition: 0.2s;
}
.btn-secondary:hover { border-color: var(--text-main); color: var(--text-main); }

/* ===== RESULT SECTION ===== */
.result-hero { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px dashed var(--border); }
.hero-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); margin-bottom: 8px; font-weight: 700; }
.hero-value { font-size: 42px; font-weight: 900; color: var(--text-main); line-height: 1; letter-spacing: -1.5px; }
.hero-sub { font-size: 14px; color: var(--success); font-weight: 600; margin-top: 8px; display: inline-block; background: var(--success-bg); padding: 4px 12px; border-radius: 20px; }

.chart-wrapper { position: relative; height: 200px; width: 100%; margin-bottom: 24px; }

.info-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
.info-box {
  background: #f8fafc; padding: 16px; border-radius: var(--radius-lg);
  border: 1px solid transparent; transition: 0.2s;
}
.info-box:hover { border-color: var(--border); background: white; }
.info-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.info-title { font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; }
.info-tag { font-size: 10px; padding: 4px 8px; border-radius: 4px; font-weight: 700; background: rgba(0,0,0,0.05); }
.info-price { font-size: 20px; font-weight: 800; color: var(--text-main); letter-spacing: -0.5px; margin-top:4px; }
.info-desc { font-size: 13px; color: var(--text-muted); line-height: 1.5; margin-top: 4px; }

.tag-warning { background: #fffbeb; color: var(--warning); border: 1px solid #fcd34d; }
.tag-success { background: var(--success-bg); color: var(--success); }
.tag-info { background: var(--info-bg); color: var(--info); }

/* List Styling */
.budget-list { list-style: none; padding: 0; margin: 10px 0 0 0; }
.budget-list li { font-size: 13px; color: var(--text-muted); margin-bottom: 4px; padding-left: 12px; position: relative; }
.budget-list li::before { content: "‚Ä¢"; position: absolute; left: 0; color: var(--primary); font-weight: bold; }

/* Advice Section */
.advice-card {
  background: #fff; border: 1px solid var(--border); padding: 16px; border-radius: var(--radius-lg);
  margin-bottom: 16px; box-shadow: var(--shadow-soft);
}
.advice-title { font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; font-size: 14px; }
.advice-text { font-size: 13px; line-height: 1.6; color: var(--text-main); font-weight: 500; }

/* Dream Result Specifics */
.dream-result-card {
  background: white; border: 1px solid var(--border); padding: 16px; border-radius: var(--radius-lg);
  margin-bottom: 16px; box-shadow: var(--shadow-soft);
}
.dream-status-badge {
  display: inline-block; padding: 6px 12px; border-radius: 8px; font-weight: 800; text-transform: uppercase; font-size: 12px; margin-top: 10px; width: 100%; text-align: center;
}
.status-success { background: var(--success-bg); color: var(--success); }
.status-fail { background: var(--danger-bg); color: var(--danger); }

/* Locked Content */
.locked-section {
  margin-top: 24px; padding: 24px; border: 2px dashed var(--border);
  background: #fff; border-radius: var(--radius-xl); text-align: center;
}
.product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
.product-card {
  background: white; border: 1px solid var(--border); padding: 16px;
  border-radius: var(--radius-lg); text-decoration: none; color: inherit;
  display: block; transition: 0.2s;
}
.product-card:hover { transform: translateY(-3px); border-color: var(--primary); box-shadow: var(--shadow-soft); }
.product-price { color: var(--primary-dark); font-weight: 800; font-size: 12px; margin-top: 4px; }

.hidden { display: none !important; }

@keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div class="app-container">
  
  <!-- LEFT COLUMN: INPUT -->
  <div class="card slide-up" id="input-section">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
      <h3 style="margin:0; font-size:18px; font-weight:800;">Data Keuangan</h3>
      <div id="apiStatus" class="api-badge"><span class="status-dot"></span> <span id="api-text">Checking...</span></div>
    </div>

    <div class="input-row form-group">
      <div>
        <label class="form-label">Gaji Pokok</label>
        <input type="text" id="gajiPokok" placeholder="0" autocomplete="off">
      </div>
      <div>
        <label class="form-label">Side Hustle</label>
        <input type="text" id="sideHustle" placeholder="0" autocomplete="off">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Status Saat Ini</label>
      <div class="input-wrapper">
        <select id="status">
          <option value="nikah">Akan Menikah</option>
          <option value="hamil">Persiapan Hamil</option>
          <option value="anak">Sudah Punya Anak</option>
        </select>
        <span class="select-arrow">‚ñº</span>
      </div>
    </div>

    <div class="input-row form-group">
      <div>
        <label class="form-label">Gaya Hidup</label>
        <div class="input-wrapper">
          <select id="lifestyle">
            <option value="hemat">Hemat (Frugal)</option>
            <option value="standar" selected>Standar</option>
            <option value="mewah">Mewah</option>
          </select>
          <span class="select-arrow">‚ñº</span>
        </div>
      </div>
      <div>
        <label class="form-label">Cicilan/Bln</label>
        <input type="text" id="debt" placeholder="0" autocomplete="off">
      </div>
    </div>

    <div class="dream-card">
      <div class="dream-header">
        <span class="dream-title">üéØ DREAM PLANNER</span>
      </div>
      <div class="input-row" style="margin-bottom:12px;">
        <div class="input-wrapper" style="flex:2;">
          <select id="dreamType" style="color:var(--text-light);">
            <option value="none">-- Pilih Aset --</option>
            <option value="rumah">Rumah / KPR</option>
            <option value="motor">Motor</option>
            <option value="mobil">Mobil</option>
            <option value="haji">Daftar Haji</option>
            <option value="gadget">Gadget</option>
            <option value="liburan">Liburan</option>
          </select>
        </div>
        <div class="input-wrapper" style="flex:1;">
          <select id="dreamMethod" style="color:var(--text-light);">
            <option value="tunai">Tunai</option>
            <option value="kredit">Kredit</option>
          </select>
        </div>
      </div>
      <input type="text" id="dreamPrice" placeholder="Estimasi Harga (Rp)" style="margin-bottom: 0;">
    </div>

    <div class="form-group">
      <label class="form-label">Target Tanggal (Opsional)</label>
      <input type="date" id="targetDate" style="color: var(--text-muted);">
    </div>

    <button class="btn-main" id="btn-calc" onclick="hitung()">
      <span id="btn-text">ANALISIS KEAMANAN SAYA</span>
    </button>
    <button class="btn-secondary hidden" id="unlock-btn" onclick="unlockForm()">‚úèÔ∏è Edit Data Ulang</button>
  </div>

  <!-- RIGHT COLUMN: RESULT -->
  <div class="card slide-up" style="animation-delay: 0.2s;" id="result-section">
    
    <div class="result-hero">
      <div class="hero-label">Total Aset Aman Tercatat</div>
      <div class="hero-value" id="emas">0 gram</div>
      <div class="hero-sub">Dana yang bisa dikunci ke emas</div>
    </div>

    <div class="chart-wrapper"><canvas id="chart"></canvas></div>

    <div id="detail-container" class="hidden">
      <!-- 1. Advice -->
      <div id="advice-wrapper"></div>

      <!-- 2. Dream Result -->
      <div id="dream-result-wrapper"></div>

      <!-- 3. Analisa Bulanan -->
      <div class="info-box" id="monthly-analysis-card">
        <div class="info-header">
          <div class="info-title" style="color:var(--info);">Analisa Bulanan</div>
          <span class="info-tag tag-info">Cash Flow</span>
        </div>
        <div style="font-size:13px; margin-bottom:8px; font-weight:600;">Total Penghasilan: <span id="cash-income" style="color:var(--text-main);">Rp 0</span></div>
        <div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:4px; color:var(--text-muted);">
          <span>Kebutuhan Hidup</span>
          <span id="cash-needs">0 (70%)</span>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:4px; color:var(--text-muted);">
          <span>Cicilan / Utang</span>
          <span id="cash-debt">0 (0%)</span>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:13px; margin-top:8px; border-top:1px dashed var(--border); padding-top:8px;">
          <span style="font-weight:700;">Kemampuan Menabung (Nyata)</span>
          <span id="cash-save" style="font-weight:800; color:var(--success);">0 (0%)</span>
        </div>
      </div>

      <!-- 4. Detailed Cards Grid -->
      <div class="info-grid" style="margin-top:16px;">
        
        <!-- Card A: Penyangga -->
        <div class="info-box">
          <div class="info-header">
            <div class="info-title">Dana Penyangga Hidup</div>
            <span class="info-tag tag-warning">Wajib Tunai</span>
          </div>
          <div class="info-price" id="buffer-price">Rp 0</div>
          <div class="info-desc">Uang tunai ini wajib ada di rekening. Ini adalah sabuk pengaman keuanganmu. Jika penghasilan berhenti (sakit/cuti/resign), uang ini menutup kebutuhan makan & sewa selama 3 bulan.</div>
        </div>

        <!-- Card B: Kebutuhan Dana Besar -->
        <div class="info-box">
          <div class="info-header">
            <div class="info-title">Kebutuhan Dana Besar</div>
            <span class="info-tag" id="lifestyle-tag-detail">Standar</span>
          </div>
          <div class="info-price" id="target-price-detail">Rp 0</div>
          <div class="info-desc">Estimasi biaya realistis dengan gaya hidup <span id="lifestyle-text">Standar</span>.</div>
          <ul class="budget-list" id="budget-list-items">
            <!-- List items injected here -->
          </ul>
        </div>

        <!-- Card C: Dana Siap Dikunci -->
        <div class="info-box" style="background: var(--success-bg); border-color: #a7f3d0;">
          <div class="info-header">
            <div class="info-title">Dana Siap Dikunci</div>
            <span class="info-tag tag-success">Bisa di Emas</span>
          </div>
          <div class="info-price" style="color: var(--success-dark);" id="safe-price-detail">Rp 0</div>
          <div class="info-desc">Ini adalah sisa dana dari total kebutuhan yang aman untuk dikunci (diinvestasikan) dalam bentuk emas.</div>
          <div style="margin-top:12px; font-size:12px; font-weight:700; color:var(--success-dark);">Setara emas: <span id="gram-detail">0</span> gram</div>
          <div style="font-size:12px; color:var(--success-dark);">Harga emas: <span id="gold-price-detail">Rp 0</span> / gram</div>
        </div>

      </div>

      <!-- 5. Target Plan (Tanggal) -->
      <div id="target-plan-card" class="info-box" style="margin-top:16px; background: white; border: 2px solid var(--primary);">
        <div class="info-header">
          <div class="info-title" style="color:var(--primary-dark);">Target Tanggal</div>
          <span class="info-tag" style="background:var(--primary-gradient); color:white;">Hitung Mundur</span>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
          <div style="font-weight:700;">Target Tanggal:</div>
          <div id="plan-date">-</div>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
          <div style="font-weight:700;">Sisa Waktu:</div>
          <div id="plan-months" style="color:var(--danger); font-weight:800;">0 Bulan</div>
        </div>
        
        <div style="background:#fffbeb; padding:12px; border-radius:8px; border:1px solid #fcd34d; margin-bottom:12px;">
          <div style="font-size:11px; font-weight:800; color:#b45309; margin-bottom:8px; text-transform:uppercase;">üî• Langkah Nyata Harian</div>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:8px;">
            <div style="text-align:center;">
              <div style="font-size:10px; color:#92400e;">Target Harian</div>
              <div style="font-size:14px; font-weight:800; color:#92400e;" id="plan-daily">Rp 0</div>
            </div>
            <div style="text-align:center;">
              <div style="font-size:10px; color:#92400e;">Target Mingguan</div>
              <div style="font-size:14px; font-weight:800; color:#92400e;" id="plan-weekly">Rp 0</div>
            </div>
          </div>
          <div style="font-size:11px; color:#b45309; font-style:italic; text-align:center;" id="plan-context">Setara dengan 1 botol air minum.</div>
        </div>

        <div style="border-top:1px dashed var(--border); padding-top:8px; text-align:right;">
          <span style="font-size:13px; color:var(--text-muted);">Total Bulanan:</span>
          <div style="font-size:18px; font-weight:900; color:var(--text-main);" id="plan-monthly">Rp 0 / bln</div>
          <div style="font-size:11px; color:var(--text-muted); font-style:italic;">*Bandingkan dengan Kemampuanmu (<span id="plan-compare">Rp 0</span>).</div>
        </div>
      </div>

      <!-- 6. Locked Monetization -->
      <div class="locked-section">
        <div style="font-size:24px; margin-bottom:8px;">üîí</div>
        <h4 style="margin:0 0 4px 0; color:var(--text-main);">Mode Premium Terkunci</h4>
        <p style="font-size:13px; color:var(--text-muted); margin:0 0 16px 0;">Dapatkan akses template Excel & E-Book.</p>
        
        <div class="product-grid">
          <a href="#" id="wa-excel" class="product-card" target="_blank">
            <div style="font-size:24px;">üìÇ</div>
            <div style="font-weight:700; margin-top:4px;">Template Excel</div>
            <div class="product-price">Rp 49.000</div>
          </a>
          <a href="#" id="wa-ebook" class="product-card" target="_blank">
            <div style="font-size:24px;">üìò</div>
            <div style="font-weight:700; margin-top:4px;">Panduan Emas (PDF)</div>
            <div class="product-price">Rp 29.000</div>
          </a>
        </div>
      </div>

    </div>

    <!-- Initial State Message -->
    <div id="initial-msg" style="text-align:center; padding: 40px 0; color:var(--text-light);">
      <div style="font-size:40px; margin-bottom:16px;">üìä</div>
      <p>Silakan isi data keuangan Anda di sebelah kiri untuk melihat analisa keamanan finansial.</p>
    </div>

  </div>
</div>

<script>
// --- UTILITIES ---
const formatIDR = (x) => new Intl.NumberFormat("id-ID").format(x);
const getRawVal = (id) => Number(document.getElementById(id).value.replace(/[^0-9]/g,"")) || 0;

// --- FORMATTER ---
const setupFormatter = (id) => {
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener("input",e=>{
    let v=e.target.value.replace(/[^0-9]/g,"");
    e.target.value=v?parseInt(v).toLocaleString("id-ID"):"";
  });
};
['gajiPokok','sideHustle','debt','dreamPrice'].forEach(setupFormatter);

// --- GOLD API LOGIC ---
let chartInstance = null;

async function getHargaEmas() {
  const badgeText = document.getElementById('api-text');
  const dot = document.querySelector('.status-dot');
  const cacheKey = 'harga_emas_cache';
  
  try {
    const c = localStorage.getItem(cacheKey);
    if(c) {
      const o = JSON.parse(c);
      if(Date.now() - o.time < 15 * 60 * 1000) {
        badgeText.innerText = "LIVE (Cached)"; dot.classList.add('online');
        return o.price;
      }
    }
    badgeText.innerText = "Updating...";
    const r = await fetch("https://logam-mulia-api.vercel.app/api/antam");
    const d = await r.json();
    localStorage.setItem(cacheKey, JSON.stringify({time:Date.now(), price:d.buy}));
    badgeText.innerText = "LIVE"; dot.classList.add('online');
    return d.buy;
  } catch(err) {
    console.log(err);
    badgeText.innerText = "OFFLINE"; dot.classList.remove('online');
    const cached = JSON.parse(localStorage.getItem(cacheKey));
    return cached ? cached.price : 2652000; // Fallback
  }
}

// --- CHART RENDERER ---
function renderChart(aman, buffer) {
  const ctx = document.getElementById('chart').getContext('2d');
  if(chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Aman (Emas)", "Penyangga (Tunai)"],
      datasets: [{
        data: [aman, buffer],
        backgroundColor: ["#10b981", "#fbbf24"],
        borderWidth: 0, hoverOffset: 4
      }]
    },
    options: {
      cutout: '80%', responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20, font: {family: 'Plus Jakarta Sans'} } } },
      animation: { animateScale: true, animateRotate: true }
    }
  });
}

// --- LOCKING MECHANISM ---
function unlockForm() {
  document.getElementById('input-section').classList.remove('hidden');
  document.getElementById('unlock-btn').classList.add('hidden');
  document.getElementById('detail-container').classList.add('hidden');
  document.getElementById('initial-msg').classList.remove('hidden');
  document.getElementById('btn-calc').classList.remove('hidden');
}

// --- CORE CALCULATION ---
async function hitung() {
  const income = getRawVal('gajiPokok') + getRawVal('sideHustle');
  const debt = getRawVal('debt');
  const dreamPrice = getRawVal('dreamPrice');
  
  if(!income) { alert("Mohon isi penghasilan Anda"); return; }

  // Loading State
  const btn = document.getElementById('btn-calc');
  const btnText = document.getElementById('btn-text');
  btn.disabled = true; btnText.innerText = "MENGHITUNG...";

  // Logic Algoritma
  const lifestyleFactor = { 'hemat': 0.8, 'standar': 1.0, 'mewah': 1.5 };
  const baseMult = { 'nikah':6, 'hamil':4, 'anak':3 };
  const statusVal = document.getElementById('status').value;
  const lifestyleVal = document.getElementById('lifestyle').value;

  const target = Math.ceil(income * baseMult[statusVal] * lifestyleFactor[lifestyleVal]);
  const buffer = Math.ceil(income * 0.7 * 3);
  const aman = Math.max(0, target - buffer);
  
  const hargaEmas = await getHargaEmas();
  const gram = aman / hargaEmas;

  // --- RENDER HEADER & CHART ---
  document.getElementById('emas').innerText = gram.toFixed(2) + " gram";
  renderChart(aman, buffer);

  // --- RENDER ADVICE ---
  const needsMonthly = Math.ceil(income * 0.7);
  const savingsMonthly = income - needsMonthly - debt;
  const isDeficit = (needsMonthly + debt) > income;
  const adviceWrapper = document.getElementById('advice-wrapper');
  let adviceText = "";

  if (statusVal === 'anak' && isDeficit) adviceText = "Jangan kurangi biaya sekolah/makan anak. Solusi wajib: Cari Side Hustle.";
  else if (statusVal === 'hamil' && isDeficit) adviceText = "Prioritas vitamin/ibu. Jangan kurangi tabungan.";
  else if (statusVal === 'nikah' && isDeficit) adviceText = "Solusi: Tunda tanggal atau Kurangi gaya hidup.";
  else if (statusVal === 'nikah') adviceText = "Jangan buru beli barang dekorasi mahal hari ini. Nabung Rp 50rb untuk mahar atau beli logam mulia lebih penting untuk masa depanmu.";
  else adviceText = "Keuangan stabil. Lanjutkan komitmen tabunganmu.";

  adviceWrapper.innerHTML = `<div class="advice-card"><div class="advice-title">üí° Nasehat Harianmu</div><div class="advice-text">${adviceText}</div></div>`;

  // --- RENDER DREAM PLANNER ---
  const dreamWrapper = document.getElementById('dream-result-wrapper');
  const dreamType = document.getElementById('dreamType').value;
  const dreamMethod = document.getElementById('dreamMethod').value;
  let dreamHTML = "";

  if(dreamType !== 'none' && dreamPrice > 0) {
    let needed = dreamMethod === 'kredit' ? dreamPrice * 0.2 : dreamPrice;
    let status = aman >= needed;
    let label = status ? 'CUKUP AMAN' : 'BELUM CUKUP';
    let msg = status ? `Selamat! Dana Amanmu (${formatIDR(aman)}) cukup untuk ${dreamType} ini.` : `Kurang Rp ${formatIDR(Math.abs(aman - needed))}. Tingkatkan tabungan!`;

    dreamHTML = `
    <div class="dream-result-card">
      <div class="info-header"><div class="info-title">üèÜ Cek Mimpi: ${dreamType.toUpperCase()}</div><span class="info-tag">${dreamMethod.toUpperCase()}</span></div>
      <div style="font-size:14px; color:var(--text-muted); margin-top:4px;">Harga Perkiraan</div>
      <div style="font-size:22px; font-weight:800; color:var(--text-main);">Rp ${formatIDR(dreamPrice)}</div>
      <div style="font-size:13px; color:var(--text-muted); margin-top:4px;">Kebutuhan Dana Tunai (DP/Lunas)</div>
      <div style="font-size:16px; font-weight:700; color:var(--text-main); margin-bottom:8px;">Rp ${formatIDR(needed)}</div>
      <div class="dream-status-badge ${status?'status-success':'status-fail'}">${label}</div>
      <div style="font-size:13px; color:var(--text-muted); text-align:center; margin-top:8px;">${msg}</div>
    </div>`;
  }
  dreamWrapper.innerHTML = dreamHTML;

  // --- RENDER MONTHLY ANALYSIS ---
  document.getElementById('cash-income').innerText = "Rp " + formatIDR(income) + " (Gaji + Bonus)";
  document.getElementById('cash-needs').innerText = formatIDR(needsMonthly) + ` (${Math.round((needsMonthly/income)*100)}%)`;
  document.getElementById('cash-debt').innerText = formatIDR(debt) + ` (${Math.round((debt/income)*100)}%)`;
  document.getElementById('cash-save').innerText = formatIDR(savingsMonthly) + ` (${100 - Math.round((needsMonthly/income)*100) - Math.round((debt/income)*100)}%)`;

  // --- RENDER DETAILED CARDS (GRID) ---
  document.getElementById('buffer-price').innerText = "Rp " + formatIDR(buffer);
  document.getElementById('target-price-detail').innerText = "Rp " + formatIDR(target);
  document.getElementById('lifestyle-tag-detail').innerText = lifestyleVal.charAt(0).toUpperCase() + lifestyleVal.slice(1);
  document.getElementById('lifestyle-text').innerText = lifestyleVal.charAt(0).toUpperCase() + lifestyleVal.slice(1);
  
  // List Items (Sesuai Permintaan)
  const reasonLists = {
    nikah: ["Biaya KUA & Legalitas Dokumen", "Mahar/Seserahan", "Biaya Akad & Pesta Sederhana", "Pindahan & Uang Muka Tempat Tinggal", "Perlengkapan Rumah Tangga", "Biaya Hidup Bulan Pertama", "Dana Cadangan Tak Terduga"],
    hamil: ["Biaya Kontrol Rutin & USG", "Suplemen & Nutrisi Ibu", "Biaya Persalinan & RS", "Biaya Dokter Spesialis", "Perlengkapan Bayi Baru", "Biaya Perawatan Pasca Melahirkan", "Dana Darurat Komplikasi"],
    anak: ["Biaya Rutin Susu & Makanan", "Imunisasi & Kesehatan", "Perlengkapan Anak", "Biaya Pendidikan Awal", "Transportasi & Aktivitas", "Biaya Hidup Tambahan", "Dana Sakit Anak"]
  };
  const listHTML = reasonLists[statusVal].map(item => `<li>${item}</li>`).join('');
  document.getElementById('budget-list-items').innerHTML = listHTML;

  document.getElementById('safe-price-detail').innerText = "Rp " + formatIDR(aman);
  document.getElementById('gram-detail').innerText = gram.toFixed(2);
  document.getElementById('gold-price-detail').innerText = "Rp " + formatIDR(hargaEmas);

  // --- RENDER TARGET PLAN ---
  const dateInput = document.getElementById('targetDate').value;
  const planCard = document.getElementById('target-plan-card');
  
  if(dateInput) {
    planCard.style.display = 'block';
    const diffMonths = Math.ceil((new Date(dateInput) - new Date()) / (1000 * 60 * 60 * 24 * 30));
    const perMonth = Math.ceil(aman / diffMonths);
    const daily = Math.ceil(perMonth / 30);
    const weekly = Math.ceil(perMonth / 4);
    
    let contextText = "";
    if (daily < 25000) contextText = "Setara dengan 1 botol air minum.";
    else if (daily < 50000) contextText = "Setara dengan 1x jajan snack kecil.";
    else contextText = "Hemat sedikit saja dari uang jajan/harian.";

    document.getElementById('plan-date').innerText = new Date(dateInput).toLocaleDateString('id-ID');
    document.getElementById('plan-months').innerText = diffMonths + " Bulan";
    document.getElementById('plan-daily').innerText = "Rp " + formatIDR(daily);
    document.getElementById('plan-weekly').innerText = "Rp " + formatIDR(weekly);
    document.getElementById('plan-context').innerText = contextText;
    document.getElementById('plan-monthly').innerText = "Rp " + formatIDR(perMonth) + " / bln";
    document.getElementById('plan-compare').innerText = "Rp " + formatIDR(savingsMonthly);
  } else {
    planCard.style.display = 'none';
  }

  // --- WA LINKS (MONETIZATION) ---
  const summary = `HONORER DIGITAL REPORT\nStatus: ${statusVal}\nGaji: Rp ${formatIDR(income)}\nTarget: Rp ${formatIDR(target)}`;
  const baseWA = "https://wa.me/6285123882845?text=" + encodeURIComponent(summary + "\n\nSaya ingin membeli: ");
  document.getElementById('wa-excel').href = baseWA + "Template Excel (Rp 49rb)";
  document.getElementById('wa-ebook').href = baseWA + "E-Book Emas (Rp 29rb)";

  // --- TRANSITION UI ---
  document.getElementById('input-section').classList.add('hidden');
  document.getElementById('unlock-btn').classList.remove('hidden');
  document.getElementById('btn-calc').classList.add('hidden');
  document.getElementById('initial-msg').classList.add('hidden');
  document.getElementById('detail-container').classList.remove('hidden');
  
  btn.disabled = false; btnText.innerText = "ANALISIS KEAMANAN SAYA";
  
  if(window.innerWidth < 768) {
    document.getElementById('result-section').scrollIntoView({behavior:'smooth'});
  }
}
</script>
</body>
</html>
